******* BN531PD 46 <4087047069>
*******================================================================
      * 7/2015 SDB MOVE BNB-START-DATE TO BNPEWS-START-DATE SO THAT THE
      *            DATE FROM THE SPREADSHEET IS USED
      ******************************************************************
      *                             BN531PD                            *
      ******************************************************************
      *                                                                *
      *  JT#      TAG      DESCRIPTION                                 *
      *  ------   ------   ------------------------------------------- *
      *  717193 | J17193 | ADDED LOGIC TO PASS DATA OF PRM-UPDATE-ACA  *
      *         |        | AND WEB-UPDATE TO THE BNBEN WS FIELDS.      *
      *  ------   ------   ------------------------------------------- *
      *  843831 | J43831 | ADDED LOGIC TO UPDATE STOP DATE IN PR14     *
      *         |        | FOR COMPANY PAID RS PLAN                    *
      *  ------   ------   ------------------------------------------- *
      *  931722 | J31722 | REVISED THE WAY VARIABLES ARE POPULATED FOR *
      *         |        | RS PLAN: BNB-COVER-OPT AND BNB-COVER-AMT    *
      *  ------   ------   ------------------------------------------- *
      *  883320 | J83320 | ADD PARAMETER FIELDS FOR FILE PATCH AND FOR *
      *         |        | FILE NAME                                   *
      *  ------   ------   ------------------------------------------- *
      * 1060209 | 060209 | Fix for EOI Field defaulting during         *
      *         |        | enrollment                                  *
      *  ------   ------   ------------------------------------------- *
      * 1189098 | 189098 | Mitigate Path Traversal Vulnerabilities     *
      *  ------   ------   ------------------------------------------- * 
000100******************************************************************
000200 050-EDIT-PARAMETERS             SECTION 10.
000300******************************************************************
000400 050-START.
000500     DISPLAY "BN531 START ".
           MOVE PRM-COMPANY            TO DB-COMPANY.
           INITIALIZE DB-PROCESS-LEVEL.
           PERFORM 840-FIND-PRSSET1.
004200     IF (PRSYSTEM-NOTFOUND)
      ******** Company {0} does not exist
004300         MOVE 120                TO CRT-ERROR-NBR
000270         MOVE PRM-COMPANY        TO CRT-ERR-VAR1
000290         MOVE WS-TRUE            TO WS-PARAMETER-ERROR
000300         PERFORM 780-PRINT-ERROR-MSG
004500         GO TO 050-END.
004600
186400     MOVE PRM-COMPANY            TO DB-COMPANY.
186500     PERFORM 840-FIND-BNCSET1.
004800     IF (BNCOMPANY-NOTFOUND)
      ******** Company {0} is not setup in benefit system
004900         MOVE 121                TO CRT-ERROR-NBR
000270         MOVE PRM-COMPANY        TO CRT-ERR-VAR1
000290         MOVE WS-TRUE            TO WS-PARAMETER-ERROR
000300         PERFORM 780-PRINT-ERROR-MSG
005100         GO TO 050-END.
005200
           IF  (PRM-USE-CURR-DATE      = "2")
           AND (PRM-THRU-DATE          NOT = ZEROES)
      ******** Thru date must be blank when using current date
004900         MOVE 122                TO CRT-ERROR-NBR
000290         MOVE WS-TRUE            TO WS-PARAMETER-ERROR
000300         PERFORM 780-PRINT-ERROR-MSG
005100         GO TO 050-END.
005200
           IF (PRM-USE-CURR-DATE       = "2")
               MOVE WS-SYSTEM-DATE-YMD TO PRM-THRU-DATE.
J83320* INVALID PATH FORMAT
J83320     IF  (PRM-INPUT-FILEPATH     NOT = SPACES)
189098         INITIALIZE IFSVALWS-PARSE-INPUT
189098         MOVE PRM-INPUT-FILEPATH     TO IFSVALWS-PARSE-INPUT
189098         MOVE 50                     TO IFSVALWS-SIZE
189098         MOVE 1                      TO IFSVALWS-FPATH-SW
189098         SET IFSVALWS-SKIP-RT        TO TRUE
189098         PERFORM 1000-VALIDATE-INPUT-STRING
189098         IF  (ERROR-FOUND)
189098*---IFSV#103: "../ and "..\" are not allowed in Filename
189098              PERFORM 780-PRINT-ERROR-MSG
189098              GO TO 050-END
189098         END-IF
J83320         MOVE SPACES             TO WS-LS-COMMAND-ARRAY
J83320         MOVE PRM-INPUT-FILEPATH TO WS-LS-COMMAND-ARRAY
J83320         MOVE 1                  TO PRLS-POINT
J83320         IF  (WS-LS-COMMAND (PRLS-POINT) NOT = "/" AND "\")
J83320             MOVE 090            TO CRT-ERROR-NBR
J83320             PERFORM 780-PRINT-ERROR-MSG
J83320             MOVE SPACES         TO WS-LS-COMMAND-ARRAY
J83320             GO TO 050-END
J83320         ELSE
J83320             PERFORM
J83320                 VARYING PRLS-POINT FROM 90 BY -1
J83320                 UNTIL (WS-LS-COMMAND (PRLS-POINT)
J83320                                     NOT = SPACES)
J83320                 CONTINUE
J83320             END-PERFORM
J83320             IF  (WS-LS-COMMAND (1)  NOT = 
J83320                                 WS-LS-COMMAND (PRLS-POINT))
J83320                 MOVE 090            TO CRT-ERROR-NBR
J83320                 PERFORM 780-PRINT-ERROR-MSG
J83320                 MOVE SPACES         TO WS-LS-COMMAND-ARRAY
J83320                 GO TO 050-END
J83320             END-IF
J83320         END-IF
J83320         MOVE SPACES                 TO WS-LS-COMMAND-ARRAY
J83320     END-IF.
189098     IF (PRM-INPUT-FILENAME     NOT = SPACES)
189098         INITIALIZE IFSVALWS-PARSE-INPUT
189098         MOVE PRM-INPUT-FILENAME     TO IFSVALWS-PARSE-INPUT
189098         MOVE 50                     TO IFSVALWS-SIZE
189098         MOVE 0                      TO IFSVALWS-FPATH-SW
189098         PERFORM 1000-VALIDATE-INPUT-STRING
189098         IF  (ERROR-FOUND)
189098*---IFSV#103: "../ and "..\" are not allowed in Filename
189098              PERFORM 780-PRINT-ERROR-MSG
189098              GO TO 050-END
189098         END-IF
189098     END-IF.
J83320     IF ((PRM-INPUT-FILEPATH     NOT = SPACES)
J83320     AND (PRM-INPUT-FILENAME         = SPACES))
J83320         MOVE 091            TO CRT-ERROR-NBR
J83320         PERFORM 780-PRINT-ERROR-MSG
J83320         GO TO 050-END
J83320     END-IF.
J83320     IF ((PRM-INPUT-FILEPATH         = SPACES)
J83320     AND (PRM-INPUT-FILENAME     NOT = SPACES))
J83320         MOVE 092            TO CRT-ERROR-NBR
J83320         PERFORM 780-PRINT-ERROR-MSG
J83320         GO TO 050-END
J83320     END-IF.

J83320     IF  (PRM-INPUT-FILEPATH     NOT = SPACES)
J83320         MOVE PRM-INPUT-FILEPATH         TO IFSVALWS-PARSE-INPUT
J83320         MOVE 50                         TO IFSVALWS-SIZE
J83320         SET IFSVALWS-FILE-PATH          TO TRUE
J83320         PERFORM 1000-VALIDATE-INPUT-STRING
J83320         IF (ERROR-FOUND)
J83320             PERFORM 780-PRINT-ERROR-MSG
J83320             MOVE "BN531"                TO CRT-ERROR-CAT
J83320             GO TO 050-END
J83320         END-IF
J83320         MOVE PRM-INPUT-FILENAME         TO IFSVALWS-PARSE-INPUT
J83320         MOVE 50                         TO IFSVALWS-SIZE
J83320         SET IFSVALWS-FILE-PATH          TO TRUE
J83320         PERFORM 1000-VALIDATE-INPUT-STRING
J83320         IF (ERROR-FOUND)
J83320             PERFORM 780-PRINT-ERROR-MSG
J83320             MOVE "BN531"                TO CRT-ERROR-CAT
J83320             GO TO 050-END
J83320         END-IF
J83320     END-IF.
J83320
000600 050-END.
000700
000800******************************************************************
000900 100-PROGRAM-CONTROL             SECTION 10.
001000******************************************************************
001100 100-START.
001200
      **** Processing BN531 - Batch Benefit Enrollment
001400     MOVE 050                        TO CRT-MSG-NBR.
001410     PERFORM 780-DISPLAY-MSG.
001420
J83320     IF  (PRM-INPUT-FILENAME     NOT = SPACES)
J83320         MOVE WS-TRUE            TO WS-FILE-SW
J83320     END-IF.
001300     MOVE ZEROS                  TO WS-BNB-COMPANY
001400                                    WS-BNB-EMPLOYEE.
001500
J83320     IF  (WS-PRM-PATH)
J83320         MOVE SPACES             TO WS-LS-COMMAND-ARRAY
J83320         MOVE 1                  TO PRLS-POINT
J83320         STRING PRM-INPUT-FILEPATH DELIMITED BY SIZE INTO
J83320         WS-LS-COMMAND-ARRAY WITH POINTER PRLS-POINT
J83320         PERFORM 
J83320             VARYING PRLS-POINT FROM 950 BY -1
J83320             UNTIL (WS-LS-COMMAND (PRLS-POINT) NOT = SPACES)
J83320             CONTINUE
J83320         END-PERFORM
J83320         ADD 1                   TO PRLS-POINT
J83320         STRING "BNBATCHERR" DELIMITED BY SIZE INTO
J83320         WS-LS-COMMAND-ARRAY WITH POINTER PRLS-POINT
J83320         PERFORM 
J83320             VARYING PRLS-POINT FROM 950 BY -1
J83320             UNTIL (WS-LS-COMMAND (PRLS-POINT) NOT = SPACES)
J83320             CONTINUE
J83320         END-PERFORM
J83320* OPEN OUTPUT ERR CSV IN PATH
J83320         ADD 1                   TO PRLS-POINT
J83320         MOVE WS-LS-COMMAND-ARRAY    TO WS-BNBATCHER2-NAME
J83320         PERFORM 800-OPENOUTPUTCSV-BNBATCHER2
J83320         PERFORM 800-ALLUSEDCSV-BNBATCHER2
J83320     ELSE
J83320         PERFORM 800-OPENOUTPUTCSV-BNBATCHERR
J83320         PERFORM 800-ALLUSEDCSV-BNBATCHERR
J83320     END-IF.
001800
           MOVE "C"                    TO BNBINFO-INFO-SET.
J83320     IF  (PRM-INPUT-FILENAME     = SPACES)
J83320         PERFORM 800-OPENINPUTCSV-BNBATCH
J83320         IF  (BNBINFO-ERROR     = "Y")
J83320         AND (BNBINFO-ERROR-NBR = 404)
J83320             PERFORM 9900-HR-PRINT-BLANK
J83320             MOVE BNBINFO-FILENAME   TO HR-PRT-LINE
J83320             PERFORM 9900-HR-PRINT-CSVIN
J83320******** Input CSV file does not exist
J83320             MOVE 118                TO CRT-MSG-NBR
J83320             PERFORM 780-PRINT-MSG
J83320             GO TO 100-END
J83320         END-IF

J83320         PERFORM 800-ALLUSEDCSV-BNBATCH
J83320         PERFORM 9900-HR-PRINT-BLANK

J83320         MOVE BNBINFO-FILENAME       TO HR-PRT-LINE
J83320         PERFORM 9900-HR-PRINT-CSVIN
J83320         PERFORM 9900-HR-PRINT-BLANK
J83320         MOVE BBEINFO-FILENAME       TO HR-PRT-LINE
J83320         PERFORM 9900-HR-PRINT-CSVOUT
          
J83320         PERFORM 9900-HR-PRINT-BLANK

J83320     ELSE
J83320* OPEN FILE FROM PARAMETER PATH/NAME
J83320         MOVE SPACES             TO WS-LS-COMMAND-ARRAY
J83320         MOVE 1                  TO PRLS-POINT
J83320         STRING PRM-INPUT-FILEPATH DELIMITED BY SIZE INTO
J83320         WS-LS-COMMAND-ARRAY WITH POINTER PRLS-POINT
J83320         PERFORM 
J83320             VARYING PRLS-POINT FROM 950 BY -1
J83320             UNTIL (WS-LS-COMMAND (PRLS-POINT) NOT = SPACES)
J83320             CONTINUE
J83320         END-PERFORM
J83320         ADD 1                   TO PRLS-POINT
J83320         STRING PRM-INPUT-FILENAME DELIMITED BY SIZE INTO
J83320         WS-LS-COMMAND-ARRAY WITH POINTER PRLS-POINT
J83320         PERFORM 
J83320             VARYING PRLS-POINT FROM 950 BY -1
J83320             UNTIL (WS-LS-COMMAND (PRLS-POINT) NOT = SPACES)
J83320             CONTINUE
J83320         END-PERFORM
J83320         ADD 1                   TO PRLS-POINT
J83320         MOVE WS-LS-COMMAND-ARRAY    TO WS-BNBATCH1-NAME
J83320         PERFORM 800-OPENINPUTCSV-BNBATCH1
J83320         IF  (BN1INFO-ERROR     = "Y")
J83320         AND (BN1INFO-ERROR-NBR = 404)
J83320             PERFORM 9900-HR-PRINT-BLANK
J83320             MOVE BN1INFO-FILENAME   TO HR-PRT-LINE
J83320             PERFORM 9900-HR-PRINT-CSVIN
J83320******** Input CSV file does not exist
J83320             MOVE 118                TO CRT-MSG-NBR
J83320             PERFORM 780-PRINT-MSG
J83320             GO TO 100-END
J83320         END-IF

J83320         PERFORM 800-ALLUSEDCSV-BNBATCH1
J83320         PERFORM 9900-HR-PRINT-BLANK

J83320         MOVE BN1INFO-FILENAME       TO HR-PRT-LINE
J83320         PERFORM 9900-HR-PRINT-CSVIN
J83320         PERFORM 9900-HR-PRINT-BLANK
J83320         MOVE BB3INFO-FILENAME       TO HR-PRT-LINE
J83320         PERFORM 9900-HR-PRINT-CSVOUT
           
J83320         PERFORM 9900-HR-PRINT-BLANK
J83320     END-IF.

001430     PERFORM 840-FIND-CKPSET1.
001440     IF  (CKPOINT-FOUND)
           AND (CKP-RESTART-INFO           NOT = SPACES)
001460         MOVE CKP-RESTART-INFO       TO WS-RESTART-DATA
               IF (WS-RECORD-COUNT         > ZEROES)
                   PERFORM 110-READ-BNBATCH
                   THRU    110-END
                       WS-RECORD-COUNT TIMES.

J83320     IF  (WS-PRM-PATH)
J83320         PERFORM 800-READCSV-BNBATCH1
J83320     ELSE
J83320         PERFORM 800-READCSV-BNBATCH
J83320     END-IF.
002300
002400     OPEN OUTPUT ERRORS-FILE.
002500
P45653     MOVE SPACES                 TO EH-COMPANY-HDR
P45653                                    EH-EMPLOYEE-HDR
P45653                                    EH-PLAN-HDR
P45653                                    EH-EMPLOYEE-UNDERLINE
P45653                                    EH-PLAN-UNDERLINE.
J83320     IF (WS-PRM-PATH)
J83320         IF (BNBATCH1-NOTFOUND)
J83320             MOVE ERROR-HEADING      TO RPT-GROUP-REQUEST
J83320             PERFORM 700-PRINT-RPT-GRP
J83320             MOVE 133                TO CRT-MSG-NBR
J83320             PERFORM 790-GET-MSG
J83320             MOVE CRT-MESSAGE        TO WS-ERR-MSG
J83320             MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
J83320             MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
J83320             PERFORM 800-WRITECSV-BNBATCHERR
J83320             PERFORM 700-PRINT-RPT-GRP
J83320*
J83320             PERFORM 800-CLOSECSV-BNBATCH1
J83320             PERFORM 800-CLOSECSV-BNBATCHER2
J83320             CLOSE ERRORS-FILE
J83320             GO TO 100-END
J83320         END-IF
J83320     ELSE
J83320         IF (BNBATCH-NOTFOUND)
J83320             MOVE ERROR-HEADING      TO RPT-GROUP-REQUEST
J83320             PERFORM 700-PRINT-RPT-GRP
J83320             MOVE 133                TO CRT-MSG-NBR
J83320             PERFORM 790-GET-MSG
J83320             MOVE CRT-MESSAGE        TO WS-ERR-MSG
J83320             MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
J83320             MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
J83320             PERFORM 800-WRITECSV-BNBATCHERR
J83320             PERFORM 700-PRINT-RPT-GRP
J83320*
J83320             PERFORM 800-CLOSECSV-BNBATCH
J83320             PERFORM 800-CLOSECSV-BNBATCHERR
J83320             CLOSE ERRORS-FILE
J83320             GO TO 100-END
J83320         END-IF
J83320     END-IF.
P45653
J83320     IF (WS-PRM-PATH)
J83320         IF  (BNBATCH1-ERROR)
J83320         AND (BN1INFO-ERROR-NBR = 202)
J83320             MOVE ERROR-HEADING      TO RPT-GROUP-REQUEST
J83320             PERFORM 700-PRINT-RPT-GRP
J83320             MOVE 132                TO CRT-MSG-NBR
J83320             PERFORM 790-GET-MSG
J83320             MOVE CRT-MESSAGE        TO WS-ERR-MSG
J83320             MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
J83320             MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
J83320             PERFORM 800-WRITECSV-BNBATCHERR
J83320             PERFORM 700-PRINT-RPT-GRP
J83320             PERFORM 800-CLOSECSV-BNBATCH1
J83320             PERFORM 800-CLOSECSV-BNBATCHER2
J83320             CLOSE ERRORS-FILE
J83320             GO TO 100-END
J83320         END-IF
J83320    ELSE
J83320         IF  (BNBATCH-ERROR)
J83320         AND (BNBINFO-ERROR-NBR = 202)
J83320             MOVE ERROR-HEADING      TO RPT-GROUP-REQUEST
J83320             PERFORM 700-PRINT-RPT-GRP
J83320             MOVE 132                TO CRT-MSG-NBR
J83320             PERFORM 790-GET-MSG
J83320             MOVE CRT-MESSAGE        TO WS-ERR-MSG
J83320             MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
J83320             MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
J83320             PERFORM 800-WRITECSV-BNBATCHERR
J83320             PERFORM 700-PRINT-RPT-GRP
J83320             PERFORM 800-CLOSECSV-BNBATCH
J83320             PERFORM 800-CLOSECSV-BNBATCHERR
J83320             CLOSE ERRORS-FILE
J83320             GO TO 100-END
J83320         END-IF
J83320     END-IF.
P45653
P45653     MOVE 129                    TO CRT-MSG-NBR.
P45653     PERFORM 790-GET-MSG.
P45653     MOVE CRT-MESSAGE            TO EH-COMPANY-HDR.
P45653     MOVE 130                    TO CRT-MSG-NBR.
P45653     PERFORM 790-GET-MSG.
P45653     MOVE CRT-MESSAGE            TO EH-EMPLOYEE-HDR.
P45653     MOVE 131                    TO CRT-MSG-NBR.
P45653     PERFORM 790-GET-MSG.
P45653     MOVE CRT-MESSAGE            TO EH-PLAN-HDR.
P45653     MOVE 134                    TO CRT-MSG-NBR.
P45653     PERFORM 790-GET-MSG.
P45653     MOVE CRT-MESSAGE            TO EH-EMPLOYEE-UNDERLINE.
P45653     MOVE 135                    TO CRT-MSG-NBR.
P45653     PERFORM 790-GET-MSG.
P45653     MOVE CRT-MESSAGE            TO EH-PLAN-UNDERLINE.
P45653
           SET NO-COMP-DATA            TO TRUE.

           PERFORM 910-AUDIT-BEGIN.

J83320     IF (WS-PRM-PATH)
J83320         PERFORM 300-LOAD-FILE
J83320             UNTIL (BNBATCH1-NOTFOUND)
J83320     ELSE
J83320         PERFORM 200-LOAD-FILE
J83320             UNTIL (BNBATCH-NOTFOUND)
J83320     END-IF.
002800
           IF (NO-COMP-DATA)
      ******** No data to process in Batch Benefit Enrollment
007170         MOVE 051                TO CRT-MSG-NBR
007180         PERFORM 780-PRINT-MSG.

           PERFORM 925-AUDIT-END.

J83320     IF (WS-PRM-PATH)
J83320         PERFORM 800-CLOSECSV-BNBATCH1
J83320         PERFORM 800-CLOSECSV-BNBATCHER2
J83320     ELSE
J83320         PERFORM 800-CLOSECSV-BNBATCH
J83320         PERFORM 800-CLOSECSV-BNBATCHERR
J83320     END-IF.
003100
003200     CLOSE ERRORS-FILE.
003300
           GO TO 100-END.

003600******************************************************************
       110-READ-BNBATCH.
003600******************************************************************

J83320     IF  (WS-PRM-PATH)
J83320         PERFORM 800-READCSV-BNBATCH1
J83320     ELSE
J83320         PERFORM 800-READCSV-BNBATCH
J83320     END-IF.

       110-END.

003400 100-END.
003500
003600******************************************************************
003700 200-LOAD-FILE                   SECTION 10.
003800******************************************************************
003900 200-START.
004000
004100     IF (BNB-COMPANY NOT = PRM-COMPANY)
               GO TO 200-NEXT.

012400     IF (BNB-START-DATE NOT = ZEROES)
012500         MOVE BNB-START-DATE        TO WSDR-FR-DATE
012600         PERFORM 900-IS-DATE-INVALID
012700         IF (WSDR-DATE-ERROR-EXISTS)
012800             MOVE 109                    TO CRT-MSG-NBR
012900             PERFORM 790-GET-MSG
                   MOVE BNB-START-DATE         TO HRWS-DATE-8-FIELD  
                   PERFORM 781-HR-FORMAT-DATE-FIELD
                   MOVE HRWS-VALUE             TO WS-FIELD-VALUE
013200             MOVE BNB-EMPLOYEE           TO EL-EMPLOYEE
013300             MOVE BNB-PLAN-TYPE          TO EL-PLAN-TYPE
013400             MOVE BNB-PLAN-CODE          TO EL-PLAN-CODE
013500             MOVE CRT-MESSAGE            TO WS-ERR-MSG
013600             MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
013700             MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
013800             PERFORM 210-WRITE-BNBATCHERR
013900             PERFORM 700-PRINT-RPT-GRP
014000             GO TO 200-NEXT.
014100  
           IF  (PRM-THRU-DATE                  NOT = ZEROES)
           AND (BNB-START-DATE                 > PRM-THRU-DATE)
                GO TO 200-NEXT.

004100     IF (BNB-COMPANY NOT = WS-BNB-COMPANY)
004200         MOVE BNB-COMPANY            TO DB-COMPANY 
004300         PERFORM 840-FIND-BNCSET1 
004400         IF (BNCOMPANY-NOTFOUND)
004500             MOVE BNB-COMPANY        TO CRT-ERR-VAR1
004600             MOVE 100                TO CRT-MSG-NBR
004700             PERFORM 790-GET-MSG
004800             MOVE BNB-EMPLOYEE       TO EL-EMPLOYEE
004900             MOVE BNB-PLAN-TYPE      TO EL-PLAN-TYPE
005000             MOVE BNB-PLAN-CODE      TO EL-PLAN-CODE
005100             MOVE CRT-MESSAGE        TO WS-ERR-MSG
005200             MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
005300             MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
005400             PERFORM 700-PRINT-RPT-GRP
005500             PERFORM 210-WRITE-BNBATCHERR
005600             GO TO 200-NEXT
005700         END-IF
005800         MOVE BNB-COMPANY        TO G1-COMPANY
006000                                    EH-COMPANY
006100                                    DB-COMPANY
006200         MOVE SPACES             TO DB-PROCESS-LEVEL
006300         PERFORM 840-FIND-PRSSET1.
007000
007100     MOVE BNB-COMPANY         TO DB-COMPANY.
007200     INITIALIZE DB-PROCESS-LEVEL.
007300     PERFORM 840-FIND-PRSSET1.
007400     IF (PRSYSTEM-NOTFOUND)
007500         MOVE BNB-COMPANY        TO CRT-ERR-VAR1
007600         MOVE 101                TO CRT-MSG-NBR
007700         PERFORM 790-GET-MSG
007800         MOVE BNB-EMPLOYEE       TO EL-EMPLOYEE
007900         MOVE BNB-PLAN-TYPE      TO EL-PLAN-TYPE
008000         MOVE BNB-PLAN-CODE      TO EL-PLAN-CODE
008100         MOVE CRT-MESSAGE        TO WS-ERR-MSG
008200         MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
008300         MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
008400         PERFORM 700-PRINT-RPT-GRP
008500         PERFORM 210-WRITE-BNBATCHERR
008600         GO TO 200-NEXT.
008700
008800     IF (BNB-EMPLOYEE NOT = WS-BNB-EMPLOYEE)
008900         MOVE BNB-COMPANY            TO DB-COMPANY 
009000         MOVE BNB-EMPLOYEE           TO DB-EMPLOYEE
009100         PERFORM 840-FIND-EMPSET1 
009200         IF (EMPLOYEE-NOTFOUND)
009300             MOVE BNB-EMPLOYEE       TO CRT-ERR-VAR1
009400             MOVE 102                TO CRT-MSG-NBR
009500             PERFORM 790-GET-MSG
009600             MOVE BNB-EMPLOYEE       TO EL-EMPLOYEE
009700             MOVE BNB-PLAN-TYPE      TO EL-PLAN-TYPE
009800             MOVE BNB-PLAN-CODE      TO EL-PLAN-CODE
009900             MOVE CRT-MESSAGE        TO WS-ERR-MSG
010000             MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
010100             MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
010200             PERFORM 700-PRINT-RPT-GRP
010300             PERFORM 210-WRITE-BNBATCHERR
010400             GO TO 200-NEXT.
010500     
           IF  (BNBINFO-ERROR     = "Y")
           AND (BNBINFO-ERROR-NBR = 203)
               MOVE 500                    TO CRT-MSG-NBR
               MOVE BNBINFO-FIELD-NBR      TO CRT-ERR-VAR1
               MOVE BNBINFO-RECORD-COUNT   TO CRT-ERR-VAR2
003266         INSPECT CRT-ERR-VAR1 REPLACING LEADING "0" BY " "
003266         INSPECT CRT-ERR-VAR2 REPLACING LEADING "0" BY " "
004700         PERFORM 790-GET-MSG
005100         MOVE CRT-MESSAGE            TO WS-ERR-MSG
004800         MOVE BNB-EMPLOYEE           TO EL-EMPLOYEE
004900         MOVE BNB-PLAN-TYPE          TO EL-PLAN-TYPE
005000         MOVE BNB-PLAN-CODE          TO EL-PLAN-CODE
005200         MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
005300         MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
005400         PERFORM 700-PRINT-RPT-GRP
005500         PERFORM 210-WRITE-BNBATCHERR
017200         GO TO 200-NEXT.

010600     IF (BNB-ENROLLMENT-DATE NOT = ZEROES)
010700         MOVE BNB-ENROLLMENT-DATE        TO WSDR-FR-DATE
010800         PERFORM 900-IS-DATE-INVALID
010900         IF (WSDR-DATE-ERROR-EXISTS)
011000             MOVE 108                    TO CRT-MSG-NBR
011100             PERFORM 790-GET-MSG
                   MOVE BNB-ENROLLMENT-DATE    TO HRWS-DATE-8-FIELD
                   PERFORM 781-HR-FORMAT-DATE-FIELD
                   MOVE HRWS-VALUE             TO WS-FIELD-VALUE
011400             MOVE BNB-EMPLOYEE           TO EL-EMPLOYEE
011500             MOVE BNB-PLAN-TYPE          TO EL-PLAN-TYPE
011600             MOVE BNB-PLAN-CODE          TO EL-PLAN-CODE
011700             MOVE CRT-MESSAGE            TO WS-ERR-MSG
011800             MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
011900             MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
012000             PERFORM 210-WRITE-BNBATCHERR
012100             PERFORM 700-PRINT-RPT-GRP
012200             GO TO 200-NEXT.
012300  
           SET COMP-DATA                       TO TRUE.

004100     IF (BNB-COMPANY NOT = WS-BNB-COMPANY)
005800         MOVE BNB-COMPANY        TO WS-BNB-COMPANY
006400         MOVE PRS-NAME           TO G1-PRS-NAME
006500                                    EH-PRS-NAME
006600         MOVE GN1-PAGE-HEADING   TO RPT-GROUP-REQUEST
006700         PERFORM 700-PRINT-RPT-GRP
006800         MOVE ERROR-HEADING      TO RPT-GROUP-REQUEST
006900         PERFORM 700-PRINT-RPT-GRP.

014200     IF (BNB-STOP-DATE NOT = ZEROES)
014300         MOVE BNB-STOP-DATE              TO WSDR-FR-DATE
014400         PERFORM 900-IS-DATE-INVALID
014500         IF (WSDR-DATE-ERROR-EXISTS)
014600             MOVE 110                    TO CRT-MSG-NBR
014700             PERFORM 790-GET-MSG
                   MOVE BNB-STOP-DATE          TO HRWS-DATE-8-FIELD  
                   PERFORM 781-HR-FORMAT-DATE-FIELD
                   MOVE HRWS-VALUE             TO WS-FIELD-VALUE
015000             MOVE BNB-EMPLOYEE           TO EL-EMPLOYEE
015100             MOVE BNB-PLAN-TYPE          TO EL-PLAN-TYPE
015200             MOVE BNB-PLAN-CODE          TO EL-PLAN-CODE
015300             MOVE CRT-MESSAGE            TO WS-ERR-MSG
015400             MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
015500             MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
015600             PERFORM 210-WRITE-BNBATCHERR
015700             PERFORM 700-PRINT-RPT-GRP
015800             GO TO 200-NEXT.
015900  
016000     IF  (BNB-YTD-CONT  NOT = ZEROES)
016100     AND (BNB-PLAN-TYPE NOT = "RS" AND "SB" AND "SP")
016200         MOVE 107                    TO CRT-MSG-NBR
016300         PERFORM 790-GET-MSG
016400         MOVE BNB-EMPLOYEE           TO EL-EMPLOYEE
016500         MOVE BNB-PLAN-TYPE          TO EL-PLAN-TYPE
016600         MOVE BNB-PLAN-CODE          TO EL-PLAN-CODE
016700         MOVE CRT-MESSAGE            TO WS-ERR-MSG
016800         MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
016900         MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
017000         PERFORM 210-WRITE-BNBATCHERR
017100         PERFORM 700-PRINT-RPT-GRP
017200         GO TO 200-NEXT.
017300
P63803     IF  (BNB-EMP-YTD-CONT NOT = ZEROES)
P63803     AND (BNB-PLAN-TYPE NOT    = "RS" AND "SB" AND "SP")
P63803         MOVE 136                    TO CRT-MSG-NBR
P63803         PERFORM 790-GET-MSG
P63803         MOVE BNB-EMPLOYEE           TO EL-EMPLOYEE
P63803         MOVE BNB-PLAN-TYPE          TO EL-PLAN-TYPE
P63803         MOVE BNB-PLAN-CODE          TO EL-PLAN-CODE
P63803         MOVE CRT-MESSAGE            TO WS-ERR-MSG
P63803         MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
P63803         MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
P63803         PERFORM 210-WRITE-BNBATCHERR
P63803         PERFORM 700-PRINT-RPT-GRP
P63803         GO TO 200-NEXT.
P63803
           IF  (BNB-PLAN-TYPE              NOT = "VA")
           AND ((BNB-BTE-EMP-GROUP         NOT = SPACES)
           OR   (BNB-BTE-POSITION          NOT = SPACES)
           OR   (BNB-BTE-ALLOC-PCT         NOT = ZEROES))
      ******** Not a VA plan; cannot enter EmpGrp, Pos, AllocPct
016200         MOVE 113                    TO CRT-MSG-NBR
016300         PERFORM 790-GET-MSG
016400         MOVE BNB-EMPLOYEE           TO EL-EMPLOYEE
016500         MOVE BNB-PLAN-TYPE          TO EL-PLAN-TYPE
016600         MOVE BNB-PLAN-CODE          TO EL-PLAN-CODE
016700         MOVE CRT-MESSAGE            TO WS-ERR-MSG
016800         MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
016900         MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
017000         PERFORM 210-WRITE-BNBATCHERR
017100         PERFORM 700-PRINT-RPT-GRP
017200         GO TO 200-NEXT.
017300
           IF  (BNB-BTE-EMP-GROUP          = SPACES)
           AND (BNB-BTE-POSITION           NOT = SPACES)
      ******** Must enter employee group when entering position
016200         MOVE 114                    TO CRT-MSG-NBR
016300         PERFORM 790-GET-MSG
016400         MOVE BNB-EMPLOYEE           TO EL-EMPLOYEE
016500         MOVE BNB-PLAN-TYPE          TO EL-PLAN-TYPE
016600         MOVE BNB-PLAN-CODE          TO EL-PLAN-CODE
016700         MOVE CRT-MESSAGE            TO WS-ERR-MSG
016800         MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
016900         MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
017000         PERFORM 210-WRITE-BNBATCHERR
017100         PERFORM 700-PRINT-RPT-GRP
017200         GO TO 200-NEXT.
017300
           IF  (BNB-BTE-ALLOC-PCT          NOT = ZEROES)
           AND (BNB-BTE-EMP-GROUP          = SPACES)
      ******** Must enter key to absence plan master record
016200         MOVE 115                    TO CRT-MSG-NBR
016300         PERFORM 790-GET-MSG
016400         MOVE BNB-EMPLOYEE           TO EL-EMPLOYEE
016500         MOVE BNB-PLAN-TYPE          TO EL-PLAN-TYPE
016600         MOVE BNB-PLAN-CODE          TO EL-PLAN-CODE
016700         MOVE CRT-MESSAGE            TO WS-ERR-MSG
016800         MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
016900         MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
017000         PERFORM 210-WRITE-BNBATCHERR
017100         PERFORM 700-PRINT-RPT-GRP
017200         GO TO 200-NEXT.
017300
010600     IF (BNB-DED-START-DATE NOT = ZEROES)
010700         MOVE BNB-DED-START-DATE        TO WSDR-FR-DATE
010800         PERFORM 900-IS-DATE-INVALID
010900         IF (WSDR-DATE-ERROR-EXISTS)
011000             MOVE 123                    TO CRT-MSG-NBR
011100             PERFORM 790-GET-MSG
                   MOVE BNB-DED-START-DATE     TO HRWS-DATE-8-FIELD
                   PERFORM 781-HR-FORMAT-DATE-FIELD
                   MOVE HRWS-VALUE             TO WS-FIELD-VALUE
011400             MOVE BNB-EMPLOYEE           TO EL-EMPLOYEE
011500             MOVE BNB-PLAN-TYPE          TO EL-PLAN-TYPE
011600             MOVE BNB-PLAN-CODE          TO EL-PLAN-CODE
011700             MOVE CRT-MESSAGE            TO WS-ERR-MSG
011800             MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
011900             MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
012000             PERFORM 210-WRITE-BNBATCHERR
012100             PERFORM 700-PRINT-RPT-GRP
012200             GO TO 200-NEXT.
012300  
010600     IF (BNB-DED-STOP-DATE NOT = ZEROES)
010700         MOVE BNB-DED-STOP-DATE        TO WSDR-FR-DATE
010800         PERFORM 900-IS-DATE-INVALID
010900         IF (WSDR-DATE-ERROR-EXISTS)
011000             MOVE 124                    TO CRT-MSG-NBR
011100             PERFORM 790-GET-MSG
                   MOVE BNB-DED-STOP-DATE      TO HRWS-DATE-8-FIELD
                   PERFORM 781-HR-FORMAT-DATE-FIELD
                   MOVE HRWS-VALUE             TO WS-FIELD-VALUE
011400             MOVE BNB-EMPLOYEE           TO EL-EMPLOYEE
011500             MOVE BNB-PLAN-TYPE          TO EL-PLAN-TYPE
011600             MOVE BNB-PLAN-CODE          TO EL-PLAN-CODE
011700             MOVE CRT-MESSAGE            TO WS-ERR-MSG
011800             MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
011900             MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
012000             PERFORM 210-WRITE-BNBATCHERR
012100             PERFORM 700-PRINT-RPT-GRP
012200             GO TO 200-NEXT.
012300  
      * Upper Case Translations

           MOVE BNB-FC                     TO HRWS-UP-FIELD.
           PERFORM 760-HR-UPPER-CASE.
           MOVE HRWS-UP-FIELD              TO BNB-FC. 

           IF (BNB-FC                 NOT = "A" AND "C" AND "D" AND "S")
004500         MOVE BNB-FC             TO CRT-ERR-VAR1
004600         MOVE 111                TO CRT-MSG-NBR
004700         PERFORM 790-GET-MSG
004800         MOVE BNB-EMPLOYEE       TO EL-EMPLOYEE
004900         MOVE BNB-PLAN-TYPE      TO EL-PLAN-TYPE
005000         MOVE BNB-PLAN-CODE      TO EL-PLAN-CODE
005100         MOVE CRT-MESSAGE        TO WS-ERR-MSG
005200         MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
005300         MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
005400         PERFORM 700-PRINT-RPT-GRP
005500         PERFORM 210-WRITE-BNBATCHERR
005600         GO TO 200-NEXT.

           IF (BNB-PLAN-TYPE NOT = SPACES)
               MOVE BNB-PLAN-TYPE          TO HRWS-UP-FIELD
               PERFORM 760-HR-UPPER-CASE
               MOVE HRWS-UP-FIELD          TO BNB-PLAN-TYPE.

           IF (BNB-PCT-AMT-FLAG NOT = SPACES)
               MOVE BNB-PCT-AMT-FLAG       TO HRWS-UP-FIELD
               PERFORM 760-HR-UPPER-CASE
               MOVE HRWS-UP-FIELD          TO BNB-PCT-AMT-FLAG.

           IF (BNB-PCT-AMT-FLAG        NOT = "P" AND "A" AND SPACES)
004500         MOVE BNB-PCT-AMT-FLAG   TO CRT-ERR-VAR1
004600         MOVE 125                TO CRT-MSG-NBR
004700         PERFORM 790-GET-MSG
004800         MOVE BNB-EMPLOYEE       TO EL-EMPLOYEE
004900         MOVE BNB-PLAN-TYPE      TO EL-PLAN-TYPE
005000         MOVE BNB-PLAN-CODE      TO EL-PLAN-CODE
005100         MOVE CRT-MESSAGE        TO WS-ERR-MSG
005200         MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
005300         MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
005400         PERFORM 700-PRINT-RPT-GRP
005500         PERFORM 210-WRITE-BNBATCHERR
               GO TO 200-NEXT.

           IF (BNB-PRE-AFT-FLAG NOT = SPACES)
               MOVE BNB-PRE-AFT-FLAG       TO HRWS-UP-FIELD
               PERFORM 760-HR-UPPER-CASE
               MOVE HRWS-UP-FIELD          TO BNB-PRE-AFT-FLAG.

           IF (BNB-PRE-AFT-FLAG        NOT = "P" AND "A" AND "B"
                                                 AND "N" AND SPACES)
004500         MOVE BNB-PCT-AMT-FLAG   TO CRT-ERR-VAR1
004600         MOVE 126                TO CRT-MSG-NBR
004700         PERFORM 790-GET-MSG
004800         MOVE BNB-EMPLOYEE       TO EL-EMPLOYEE
004900         MOVE BNB-PLAN-TYPE      TO EL-PLAN-TYPE
005000         MOVE BNB-PLAN-CODE      TO EL-PLAN-CODE
005100         MOVE CRT-MESSAGE        TO WS-ERR-MSG
005200         MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
005300         MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
005400         PERFORM 700-PRINT-RPT-GRP
005500         PERFORM 210-WRITE-BNBATCHERR
               GO TO 200-NEXT.

           IF (BNB-SMOKER-FLAG NOT = SPACES)
               MOVE BNB-SMOKER-FLAG        TO HRWS-UP-FIELD
               PERFORM 760-HR-UPPER-CASE
               MOVE HRWS-UP-FIELD          TO BNB-SMOKER-FLAG.

           IF (BNB-SMOKER-FLAG         NOT = "N" AND "Y" AND SPACES)
004500         MOVE BNB-SMOKER-FLAG    TO CRT-ERR-VAR1
004600         MOVE 127                TO CRT-MSG-NBR
004700         PERFORM 790-GET-MSG
004800         MOVE BNB-EMPLOYEE       TO EL-EMPLOYEE
004900         MOVE BNB-PLAN-TYPE      TO EL-PLAN-TYPE
005000         MOVE BNB-PLAN-CODE      TO EL-PLAN-CODE
005100         MOVE CRT-MESSAGE        TO WS-ERR-MSG
005200         MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
005300         MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
005400         PERFORM 700-PRINT-RPT-GRP
005500         PERFORM 210-WRITE-BNBATCHERR
               GO TO 200-NEXT.

           IF (BNB-PEND-EVIDENCE NOT = SPACES)
               MOVE BNB-PEND-EVIDENCE      TO HRWS-UP-FIELD
               PERFORM 760-HR-UPPER-CASE
               MOVE HRWS-UP-FIELD          TO BNB-PEND-EVIDENCE.

           IF (BNB-PEND-EVIDENCE       NOT = "N" AND "A" AND "P"
                                                         AND SPACES)
004500         MOVE BNB-PEND-EVIDENCE  TO CRT-ERR-VAR1
004600         MOVE 128                TO CRT-MSG-NBR
004700         PERFORM 790-GET-MSG
004800         MOVE BNB-EMPLOYEE       TO EL-EMPLOYEE
004900         MOVE BNB-PLAN-TYPE      TO EL-PLAN-TYPE
005000         MOVE BNB-PLAN-CODE      TO EL-PLAN-CODE
005100         MOVE CRT-MESSAGE        TO WS-ERR-MSG
005200         MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
005300         MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
005400         PERFORM 700-PRINT-RPT-GRP
005500         PERFORM 210-WRITE-BNBATCHERR
               GO TO 200-NEXT.

           IF (BNB-BTE-EMP-GROUP NOT = SPACES)
               MOVE BNB-BTE-EMP-GROUP      TO HRWS-UP-FIELD
               PERFORM 760-HR-UPPER-CASE
               MOVE HRWS-UP-FIELD          TO BNB-BTE-EMP-GROUP.

           IF (BNB-BTE-POSITION NOT = SPACES)
               MOVE BNB-BTE-POSITION       TO HRWS-UP-FIELD
               PERFORM 760-HR-UPPER-CASE
               MOVE HRWS-UP-FIELD          TO BNB-BTE-POSITION.

           MOVE WS-FALSE                   TO BN531WS-STOP-BENEFIT-SW
                                              BN531WS-STOP-CONT5-SW.

017400     IF (BNB-FC = "C" OR "D" OR "S")
017500         MOVE WS-FALSE           TO BN531WS-STOP-BENEFIT-SW
017600         PERFORM 220-EDIT-INPUT-DATA
017700         IF (ERROR-FOUND)
017800             MOVE CRT-ERROR-NBR      TO CRT-MSG-NBR
017900             MOVE ZEROS              TO CRT-ERROR-NBR
018000             PERFORM 790-GET-MSG
018100             MOVE BNB-EMPLOYEE       TO EL-EMPLOYEE
018200             MOVE BNB-PLAN-TYPE      TO EL-PLAN-TYPE
018300             MOVE BNB-PLAN-CODE      TO EL-PLAN-CODE
018400             MOVE CRT-MESSAGE        TO WS-ERR-MSG
018500             MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
018600             MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
018700             PERFORM 210-WRITE-BNBATCHERR
018800             PERFORM 700-PRINT-RPT-GRP
018900             GO TO 200-NEXT.
019000
019100     INITIALIZE BNBEN-DETAIL-GROUP
019200                BNBEN-USE-NAVIGATE-SW.
019300 
019400     IF (BNB-FC                  = "D")
019500         MOVE "C"                TO BNBEN-FC
019600     ELSE
019700         MOVE BNB-FC             TO BNBEN-FC.
019800     MOVE 1                      TO BNBEN-FC-FN.
019900     MOVE BNB-COMPANY            TO BNBEN-COMPANY.
020000     MOVE 2                      TO BNBEN-COMPANY-FN.
020100     MOVE BNB-ENROLLMENT-DATE    TO BNBEN-ENROLLMENT-DATE.
020200     MOVE 3                      TO BNBEN-ENROLLMENT-DATE-FN.
020300     MOVE 1                      TO BNBEN-NBR-LINES.           
020400     IF (BN531WS-STOP-BENEFIT)
020500         MOVE "S"                TO BNBEN-LINE-FC (1)
020600     ELSE
020700         MOVE BNB-FC             TO BNBEN-LINE-FC (1).
020800     MOVE 4                      TO BNBEN-LINE-FC-FN (1).
020900     MOVE BNB-EMPLOYEE           TO BNBEN-EMPLOYEE (1).
021000     MOVE 5                      TO BNBEN-EMPLOYEE-FN (1).
021100     MOVE BNB-PLAN-TYPE          TO BNBEN-PLAN-TYPE (1).
021200     MOVE 6                      TO BNBEN-PLAN-TYPE-FN (1).
021300     MOVE BNB-PLAN-CODE          TO BNBEN-PLAN-CODE (1).
021400     MOVE 7                      TO BNBEN-PLAN-CODE-FN (1).
021500     MOVE BNB-COVER-OPT          TO BNBEN-COVER-OPT (1).
021600     MOVE 8                      TO BNBEN-COVER-OPT-FN (1).
021700     MOVE BNB-MULT-SALARY        TO BNBEN-MULT-SALARY (1).
021800     MOVE BNB-COVER-AMT          TO BNBEN-COVER-AMT (1).
021900     MOVE BNB-PAY-RATE           TO BNBEN-PAY-RATE (1).
022000     MOVE 9                      TO BNBEN-PAY-RATE-FN (1).
022100     MOVE BNB-PCT-AMT-FLAG       TO BNBEN-PCT-AMT-FLAG (1).
022200     MOVE BNB-START-DATE         TO BNBEN-START-DATE (1).
022300     IF (BNBEN-LINE-FC (1) = "C" OR "D" OR "S")
022400         MOVE BNB-START-DATE     TO BNBEN-PT-START-DATE (1).
022500
022600*    IF  (BNB-START-DATE      = ZEROES)
022700*    AND (BNB-ENROLLMENT-DATE NOT = ZEROES)
022800*        MOVE BNB-ENROLLMENT-DATE TO BNBEN-START-DATE (1).
022900
023000     MOVE 10                     TO BNBEN-START-DATE-FN (1).
023100     MOVE BNB-PRE-AFT-FLAG       TO BNBEN-PRE-AFT-FLAG (1).
023200     MOVE BNB-SMOKER-FLAG        TO BNBEN-SMOKER-FLAG (1).
023300     MOVE BNB-EMP-PRE-CONT       TO BNBEN-EMP-PRE-CONT (1).
023400     MOVE 11                     TO BNBEN-EMP-PRE-CONT-FN (1).
023500     MOVE BNB-EMP-AFT-CONT       TO BNBEN-EMP-AFT-CONT (1).
023600     MOVE 12                     TO BNBEN-EMP-AFT-CONT-FN (1).
J43831     MOVE BN531WS-EMP-COMP-CONT  TO BNBEN-COMP-CONT (1).
023700     MOVE BNB-STOP-DATE          TO BNBEN-STOP-DATE (1).
023800     MOVE 13                     TO BNBEN-STOP-DATE-FN (1).
023900     MOVE BNB-PEND-EVIDENCE      TO BNBEN-PEND-EVIDENCE (1).
060209     IF  (BNB-PEND-EVIDENCE      = SPACES)   
060209          MOVE "N"               TO BNBEN-PEND-EVIDENCE (1)
060209     END-IF. 
           MOVE BNB-YTD-CONT           TO BNBEN-YTD-CONT (1).
P63803     MOVE BNB-EMP-YTD-CONT       TO BNBEN-EMP-YTD-CONT (1).
           MOVE BNB-CREATION-DATE      TO BNBEN-CREATION-DATE (1).
           MOVE BNB-UPD-DATE           TO BNBEN-UPD-DATE (1).
           MOVE BNB-TIME-STAMP         TO BNBEN-TIME-STAMP (1).
           MOVE BNB-USER-ID            TO BNBEN-USER-ID (1).
           MOVE BNB-CREATE-TRANS       TO BNBEN-CREATE-TRANS (1).
           MOVE BNB-REASON             TO BNBEN-REASON (1).
           MOVE BNB-MEMBER-ID          TO BNBEN-MEMBER-ID (1).
           MOVE BNB-BTE-EMP-GROUP      TO BNBEN-BTE-EMP-GRP (1).
           MOVE BNB-BTE-POSITION       TO BNBEN-BTE-POSITION (1).
           MOVE BNB-BTE-ALLOC-PCT      TO BNBEN-BTE-ALLOC-PCT (1).
           MOVE BNB-DED-START-DATE     TO BNBEN-DED-START-DATE (1).
           MOVE BNB-DED-STOP-DATE      TO BNBEN-DED-STOP-DATE (1).
P84931     IF (BNB-STOP-DATE       NOT = ZEROES)
J73344         MOVE BNB-STOP-DATE      TO BNBEN-PRE-STOP-DATE (1)
P84931     END-IF.
P84931     IF (BNB-DED-START-DATE  NOT = ZEROES)
J73344         MOVE BNB-DED-START-DATE TO BNBEN-PRE-DED-START-DATE (1)
P84931     END-IF.
P84931     IF (BNB-DED-STOP-DATE   NOT = ZEROES)
J73344         MOVE BNB-DED-STOP-DATE  TO BNBEN-PRE-DED-STOP-DATE (1)
P84931     END-IF.
024000
024100     IF (BN531WS-STOP-CONT5)
024200         MOVE ZEROES             TO BNBEN-COVER-OPT (1)
024300                                    BNBEN-PAY-RATE (1).
J17193     MOVE BNB-WEB-UPDATE         TO BNBEN-WEB-UPDATE.
J17193     IF  (BNB-WEB-UPDATE = "Y")
J30892         IF  (BNB-RULE-TYPE     = SPACES)
J30892         OR  (BNB-FAMILY-STATUS = SPACES)
J30892         OR  (BNB-ENROLL-DATE   = ZEROS)
J30892             MOVE "N"                TO BNBEN-WEB-UPDATE
J30892         ELSE
J30892         IF  (BNB-FAMILY-STATUS NOT = "ANNUAL" AND "NEW HIRE" AND
J30892                                      "BIRTH"  AND "ADOPTION" AND
J30892                                      "MOVE"   AND "MARRIAGE" AND
J30892                                      "LEGAL SEP" AND 
J30892                                      "SPS CHANGE")
J30892             MOVE "N"                TO BNBEN-WEB-UPDATE
J30892         ELSE
J17193             MOVE BNB-RULE-TYPE      TO BNBEN-RULE-TYPE
J17193             MOVE BNB-FAMILY-STATUS  TO BNBEN-FAMILY-STATUS
J17193             MOVE BNB-ENROLL-DATE    TO BNBEN-NEW-DATE
J30892         END-IF
J30892         END-IF
J17193     ELSE
J17193         MOVE SPACES             TO BNBEN-RULE-TYPE
J17193         MOVE SPACES             TO BNBEN-FAMILY-STATUS
J17193         MOVE ZEROES             TO BNBEN-NEW-DATE
J17193     END-IF.
J17193     IF  (PRM-UPDATE-ACA = "1")   
J17193         MOVE "N"                TO BNBEN-UPDATE-ACA.
J17193     IF  (PRM-UPDATE-ACA = "2")   
J17193         MOVE "Y"                TO BNBEN-UPDATE-ACA.
024400
0710***********TO FIX BNPE70PD
           MOVE BNB-START-DATE         TO BNPEWS-START-DATE. 
           DISPLAY "BNB-START-DATE " BNB-START-DATE.
024500     PERFORM 2000-BNBEN-EDIT-TRAN.

024600
024700     IF (ERROR-FOUND)
               IF (CRT-ERROR-NBR       = 311)
      ************ Warning:Record updated; Change will affect YTD amount
024800             MOVE CRT-ERROR-NBR      TO CRT-MSG-NBR
024900             INITIALIZE CRT-ERROR-NBR
024900                        CRT-ERROR-CAT
024900                        CRT-ERR-VAR1
024900                        CRT-ERR-VAR2
024900                        CRT-ERR-VAR3
024900                        CRT-ERR-VAR4
024900                        CRT-ERR-VAR5
025000             PERFORM 790-GET-MSG
025100             MOVE BNB-EMPLOYEE       TO EL-EMPLOYEE
025200             MOVE BNB-PLAN-TYPE      TO EL-PLAN-TYPE
025300             MOVE BNB-PLAN-CODE      TO EL-PLAN-CODE
025400             MOVE CRT-MESSAGE        TO WS-ERR-MSG
025500             MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
025600             MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
025800             PERFORM 700-PRINT-RPT-GRP
               ELSE
024800             MOVE CRT-ERROR-NBR      TO CRT-MSG-NBR
                   IF (CRT-ERROR-NBR       = 113)
                       MOVE WS-TRUE        TO BN531WS-ERR-SW
                   END-IF
024900             MOVE ZEROS              TO CRT-ERROR-NBR
025000             PERFORM 790-GET-MSG
025100             MOVE BNB-EMPLOYEE       TO EL-EMPLOYEE
025200             MOVE BNB-PLAN-TYPE      TO EL-PLAN-TYPE
025300             MOVE BNB-PLAN-CODE      TO EL-PLAN-CODE
025400             MOVE CRT-MESSAGE        TO WS-ERR-MSG
025500             MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
025600             MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
025700             PERFORM 210-WRITE-BNBATCHERR
025800             PERFORM 700-PRINT-RPT-GRP
025900             GO TO 200-NEXT.
026000
           IF  (BNBEN-COV-OVER-FLG (1) = "Y")
           AND (PLN-COVERAGE-TYPE      = "2")
      ******** Warning: Salary has been overridden for this benefit
024800         MOVE 112                TO CRT-MSG-NBR
024900         INITIALIZE CRT-ERROR-NBR
025000         PERFORM 790-GET-MSG
025100         MOVE BNB-EMPLOYEE       TO EL-EMPLOYEE
025200         MOVE BNB-PLAN-TYPE      TO EL-PLAN-TYPE
025300         MOVE BNB-PLAN-CODE      TO EL-PLAN-CODE
025400         MOVE CRT-MESSAGE        TO WS-ERR-MSG
025500         MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
025600         MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
025800         PERFORM 700-PRINT-RPT-GRP.
026000
026700     MOVE BNBEN-EMPLOYEE (1)     TO G2-EMPLOYEE.
026800     MOVE EMP-LAST-NAME          TO HRWS-LAST-NAME.
026900     MOVE EMP-FIRST-NAME         TO HRWS-FIRST-NAME.
027000     MOVE EMP-MIDDLE-INIT        TO HRWS-MIDDLE-INIT.
           MOVE EMP-LAST-NAME-PRE      TO HRWS-LAST-NAME-PRE.
           MOVE EMP-NAME-SUFFIX        TO HRWS-NAME-SUFFIX.
027100     PERFORM 750-HR-FORMAT-NAME.
027200     MOVE HRWS-FORMAT-NAME       TO G2-SHORT-NAME.
027800     MOVE BNBEN-PLAN-TYPE (1)    TO G2-PLAN-TYPE.
027900     MOVE BNBEN-PLAN-CODE (1)    TO G2-PLAN-CODE.
028000     MOVE BNBEN-COVER-OPT (1)    TO G2-COVER-OPT.
028100     MOVE BNBEN-MULT-SALARY (1)  TO G2-MULT-SALARY.
028200     MOVE BNBEN-COVER-AMT (1)    TO G2-COVER-AMT.
028300     MOVE BNBEN-PAY-RATE (1)     TO G2-PAY-RATE.
028400     MOVE BNBEN-PCT-AMT-FLAG (1) TO G2-PCT-AMT-FLAG.
028500     MOVE BNBEN-START-DATE (1)   TO G2-START-DATE.
028600     MOVE BNBEN-PRE-AFT-FLAG (1) TO G2-PRE-AFT-FLAG.
028700     MOVE BNBEN-SMOKER-FLAG (1)  TO G2-SMOKER-FLAG.
028800     MOVE BNBEN-EMP-PRE-CONT (1) TO G2-EMP-PRE-CONT.
028900     MOVE BNBEN-EMP-AFT-CONT (1) TO G2-EMP-AFT-CONT.
029000     MOVE BNBEN-CMP-FLX-CONT (1) TO G2-CMP-FLX-CONT.
029100     MOVE BNBEN-COMP-CONT (1)    TO G2-COMP-CONT.
029200     MOVE BNBEN-STOP-DATE (1)    TO G3-STOP-DATE.
029400     MOVE BNBEN-YTD-CONT (1)     TO G2-YTD-CONT.
029500     MOVE GN2-BENEFIT            TO RPT-GROUP-REQUEST.
029600     PERFORM 700-PRINT-RPT-GRP.
029700
029800     INITIALIZE G3-DED-CMP-FLX-CONT
029900                G3-DED-EMP-PRE-CONT
030000                G3-DED-EMP-AFT-CONT
030100                G3-DED-COMP-CONT.
030200
           IF (PRM-UPDATE-OPTION               = "1")
               IF (G3-STOP-DATE                NOT = ZEROES)
004600             MOVE 116                    TO CRT-MSG-NBR
004700             PERFORM 790-GET-MSG
                   MOVE CRT-MESSAGE            TO G3-STOP-TITLE
036000             MOVE GN3-DEDUCTION          TO RPT-GROUP-REQUEST
036100             PERFORM 700-PRINT-RPT-GRP
               END-IF
           ELSE
P43617         IF  (BNB-FC NOT = "D")
P43617             PERFORM 4000-BNBEN-PROCESS-TRAN
P43617             ADD 1                       TO WS-RECORD-COUNT
P43617             ADD 3                       TO WS-UPDATE-COUNT
P43617             IF  (WS-UPDATE-COUNT         > WS-MAX-OPS-IN-TRAN)
P43617                 PERFORM 840-MODIFY-CKPSET1
P43617                 MOVE WS-RESTART-DATA    TO CKP-RESTART-INFO
P43617                 PERFORM 820-STORE-CKPOINT
P43617                 INITIALIZE WS-UPDATE-COUNT
P43617                 PERFORM 925-AUDIT-END
P43617                 PERFORM 910-AUDIT-BEGIN
P43617             END-IF
P43617         END-IF
026600
030300         IF  (BEN-CMP-FLX-CONT           NOT = ZEROES)
030400         AND (BEN-FLEX-DED-SEQ           NOT = ZEROES)
030500             MOVE BEN-COMPANY            TO DB-COMPANY
030600             MOVE BEN-EMPLOYEE           TO DB-EMPLOYEE
030700             MOVE PLN-FLEX-DED-CODE      TO DB-DED-CODE
030800             MOVE BEN-FLEX-DED-SEQ       TO DB-SEQ-NBR
030900             PERFORM 840-FIND-EDMSET1
031000             MOVE EDM-NEXT-AMOUNT        TO G3-DED-CMP-FLX-CONT
               END-IF
031100
031200         IF (BEN-EMP-PRE-CONT            NOT = ZEROES)
031300             MOVE BEN-COMPANY            TO DB-COMPANY
031400             MOVE BEN-EMPLOYEE           TO DB-EMPLOYEE
031500             IF (BEN-PCT-AMT-FLAG        = "A")
031600                 MOVE PLN-PRE-DED-CODE-A TO DB-DED-CODE
031700             ELSE
031800                 MOVE PLN-PRE-DED-CODE-P TO DB-DED-CODE
031900             END-IF
032000             MOVE BEN-PRE-SEQ-NBR        TO DB-SEQ-NBR
032100             PERFORM 840-FIND-EDMSET1
J04191             IF (EMDEDMASTR-FOUND)
032200                 MOVE EDM-NEXT-AMOUNT    TO G3-DED-EMP-PRE-CONT
J04191             END-IF
               END-IF
032300
032400         IF (BEN-EMP-AFT-CONT            NOT = ZEROES)
032500             MOVE BEN-COMPANY            TO DB-COMPANY
032600             MOVE BEN-EMPLOYEE           TO DB-EMPLOYEE
032700             IF (BEN-PCT-AMT-FLAG        = "A")
032800                 MOVE PLN-AFT-DED-CODE-A TO DB-DED-CODE
032900             ELSE
033000                 MOVE PLN-AFT-DED-CODE-P TO DB-DED-CODE
033100             END-IF
033200             MOVE BEN-AFT-SEQ-NBR        TO DB-SEQ-NBR
033300             PERFORM 840-FIND-EDMSET1
J04191             IF (EMDEDMASTR-FOUND)
033400                 MOVE EDM-NEXT-AMOUNT    TO G3-DED-EMP-AFT-CONT
J04191             END-IF
               END-IF
033500
033600         IF (BEN-COMP-CONT               NOT = ZEROES)
033700             MOVE BEN-COMPANY            TO DB-COMPANY
033800             MOVE BEN-EMPLOYEE           TO DB-EMPLOYEE
033900             IF (BEN-PCT-AMT-FLAG        = "P")
034200                 MOVE PLN-CMP-DED-CODE-P TO DB-DED-CODE
034100             ELSE
034000                 MOVE PLN-CMP-DED-CODE-A TO DB-DED-CODE
034300             END-IF
034400             MOVE BEN-CMP-SEQ-NBR        TO DB-SEQ-NBR
034500             PERFORM 840-FIND-EDMSET1
034600             IF (EMDEDMASTR-NOTFOUND)
034700                 IF (BEN-PCT-AMT-FLAG    = "A")
J18344                     IF (BEN-PRE-AFT-FLAG = "P")
034800                         MOVE PLN-PRE-DED-MTCH-A TO DB-DED-CODE
J18344                         MOVE BEN-CMP-SEQ-NBR    TO DB-SEQ-NBR
J18344                     ELSE
J18344                         MOVE PLN-AFT-DED-MTCH-A TO DB-DED-CODE
J18344                         MOVE BEN-CMP-AFT-SEQ    TO DB-SEQ-NBR
J18344                     END-IF
034900                 ELSE
J18344                     IF (BEN-PRE-AFT-FLAG = "P")
035000                         MOVE PLN-PRE-DED-MTCH-P TO DB-DED-CODE
J18344                         MOVE BEN-CMP-SEQ-NBR    TO DB-SEQ-NBR
J18344                     ELSE
J18344                         MOVE PLN-AFT-DED-MTCH-P TO DB-DED-CODE
J18344                         MOVE BEN-CMP-AFT-SEQ    TO DB-SEQ-NBR
J18344                     END-IF
035100                 END-IF
035200                 PERFORM 840-FIND-EDMSET1
035300             END-IF
J04191             IF (EMDEDMASTR-FOUND)
035400                 MOVE EDM-NEXT-AMOUNT        TO G3-DED-COMP-CONT
J04191             END-IF
               END-IF
P43617
P43617         IF  (BNB-FC = "D")
P43617             PERFORM 4000-BNBEN-PROCESS-TRAN
P43617             ADD 1                       TO WS-RECORD-COUNT
P43617             ADD 3                       TO WS-UPDATE-COUNT
P43617             IF  (WS-UPDATE-COUNT         > WS-MAX-OPS-IN-TRAN)
P43617                 PERFORM 840-MODIFY-CKPSET1
P43617                 MOVE WS-RESTART-DATA    TO CKP-RESTART-INFO
P43617                 PERFORM 820-STORE-CKPOINT
P43617                 INITIALIZE WS-UPDATE-COUNT
P43617                 PERFORM 925-AUDIT-END
P43617                 PERFORM 910-AUDIT-BEGIN
P43617             END-IF
P43617         END-IF
035500
               INITIALIZE G3-STOP-TITLE
035600         IF (G3-DED-CMP-FLX-CONT         NOT = ZEROES)
035700         OR (G3-DED-EMP-PRE-CONT         NOT = ZEROES)
035800         OR (G3-DED-EMP-AFT-CONT         NOT = ZEROES)
035900         OR (G3-DED-COMP-CONT            NOT = ZEROES)
               OR (G3-STOP-DATE                NOT = ZEROES)
                   IF (G3-STOP-DATE            NOT = ZEROES)
004600                 MOVE 116                TO CRT-MSG-NBR
004700                 PERFORM 790-GET-MSG
                       MOVE CRT-MESSAGE        TO G3-STOP-TITLE
                   END-IF
035600             IF (G3-DED-CMP-FLX-CONT     NOT = ZEROES)
035700             OR (G3-DED-EMP-PRE-CONT     NOT = ZEROES)
035800             OR (G3-DED-EMP-AFT-CONT     NOT = ZEROES)
035900             OR (G3-DED-COMP-CONT        NOT = ZEROES)
004600                 MOVE 117                TO CRT-MSG-NBR
004700                 PERFORM 790-GET-MSG
                       MOVE CRT-MESSAGE        TO G3-DED-TITLE
                   END-IF
036000             MOVE GN3-DEDUCTION          TO RPT-GROUP-REQUEST
036100             PERFORM 700-PRINT-RPT-GRP.
036200
036000     MOVE GN4-BLANK-LINE             TO RPT-GROUP-REQUEST.
036100     PERFORM 700-PRINT-RPT-GRP.

036300 200-NEXT.
036400     INITIALIZE BNB-BNBATCH-REC.
036500     PERFORM 800-READCSV-BNBATCH.
036600
036700 200-END.
036800
036900******************************************************************
037000 210-WRITE-BNBATCHERR            SECTION 10.
037100******************************************************************
037200 210-START.
037300
           INITIALIZE BBE-BNBATCHERR-REC.

037400     MOVE BNB-FC                     TO BBE-FC.
037500     MOVE BNB-COMPANY                TO BBE-COMPANY.
037600     MOVE BNB-ENROLLMENT-DATE        TO BBE-ENROLLMENT-DATE.
037700     MOVE BNB-EMPLOYEE               TO BBE-EMPLOYEE.
037800     MOVE BNB-PLAN-TYPE              TO BBE-PLAN-TYPE.
037900     MOVE BNB-PLAN-CODE              TO BBE-PLAN-CODE.
038000     MOVE BNB-COVER-OPT              TO BBE-COVER-OPT.
038400     MOVE BNB-PCT-AMT-FLAG           TO BBE-PCT-AMT-FLAG.
038500     MOVE BNB-START-DATE             TO BBE-START-DATE.
038600     MOVE BNB-PRE-AFT-FLAG           TO BBE-PRE-AFT-FLAG.
038700     MOVE BNB-SMOKER-FLAG            TO BBE-SMOKER-FLAG.
039000     MOVE BNB-STOP-DATE              TO BBE-STOP-DATE.
039100     MOVE BNB-PEND-EVIDENCE          TO BBE-PEND-EVIDENCE.
           MOVE BNB-CREATION-DATE          TO BBE-CREATION-DATE.
           MOVE BNB-UPD-DATE               TO BBE-UPD-DATE.
           MOVE BNB-USER-ID                TO BBE-USER-ID.
           MOVE BNB-TIME-STAMP             TO BBE-TIME-STAMP.
           MOVE BNB-CREATE-TRANS           TO BBE-CREATE-TRANS.
           MOVE BNB-REASON                 TO BBE-REASON.
           MOVE BNB-MEMBER-ID              TO BBE-MEMBER-ID.
           MOVE BNB-DED-START-DATE         TO BBE-DED-START-DATE.
           MOVE BNB-DED-STOP-DATE          TO BBE-DED-STOP-DATE.

      **** If there is non-numeric data we do not want to move signed
      **** numeric field
           IF  (BNBINFO-ERROR     = "Y")
           AND (BNBINFO-ERROR-NBR = 203)
               CONTINUE
           ELSE
038100         MOVE BNB-MULT-SALARY        TO BBE-MULT-SALARY
038200         MOVE BNB-COVER-AMT          TO BBE-COVER-AMT
038300         MOVE BNB-PAY-RATE           TO BBE-PAY-RATE
038800         MOVE BNB-EMP-PRE-CONT       TO BBE-EMP-PRE-CONT
038900         MOVE BNB-EMP-AFT-CONT       TO BBE-EMP-AFT-CONT
039200         MOVE BNB-YTD-CONT           TO BBE-YTD-CONT
P63803         MOVE BNB-EMP-YTD-CONT       TO BBE-EMP-YTD-CONT
               INITIALIZE BBE-DFT-PRE-CONT
                          BBE-AFT-TAX-TO-SPEND
               IF (BN531WS-113-ERROR)
                   MOVE BNFRWS-TOTAL-AVAIL TO BBE-DFT-PRE-CONT
                   MOVE BNBEN-EMP-PRE-CONT (I1)
                                           TO BBE-AFT-TAX-TO-SPEND.

           INITIALIZE WS-FIELD-VALUE.
039300
039400     PERFORM 800-WRITECSV-BNBATCHERR.
039500
039600 210-END.
039700******************************************************************
039800 220-EDIT-INPUT-DATA             SECTION 10.
039900******************************************************************
040000 220-START.
040100
040200     IF (BNB-COMPANY    = ZEROES)
040300     OR (BNB-EMPLOYEE   = ZEROES)
040400     OR (BNB-PLAN-TYPE  = SPACES)
040500     OR (BNB-PLAN-CODE  = SPACES)
040600     OR (BNB-START-DATE = ZEROES)
040700         MOVE 104                        TO CRT-ERROR-NBR
040800         GO TO 220-END.
040900
041000     MOVE BNB-COMPANY            TO DB-COMPANY.
041100     MOVE BNB-EMPLOYEE           TO DB-EMPLOYEE.
041200     MOVE BNB-PLAN-TYPE          TO DB-PLAN-TYPE.
041300     MOVE BNB-PLAN-CODE          TO DB-PLAN-CODE.
041400     MOVE BNB-START-DATE         TO DB-START-DATE.
041500     PERFORM 840-FIND-BENSET1.
041600     IF (BENEFIT-NOTFOUND)
041700         MOVE 103                        TO CRT-ERROR-NBR
041800         GO TO 220-END.
041900
J43831     MOVE BEN-COMP-CONT              TO BN531WS-EMP-COMP-CONT.
042000     IF (BNB-MULT-SALARY = ZEROES)
042100         MOVE BEN-MULTIPLE           TO BNB-MULT-SALARY.
042200     IF (BNB-PCT-AMT-FLAG = SPACES)
042300         MOVE BEN-PCT-AMT-FLAG       TO BNB-PCT-AMT-FLAG.
042400     IF (BNB-SMOKER-FLAG = SPACES)
042500         MOVE BEN-SMOKER             TO BNB-SMOKER-FLAG.
042600     IF (BNB-EMP-PRE-CONT = ZEROES)
042700         MOVE BEN-EMP-PRE-CONT       TO BNB-EMP-PRE-CONT.
042800     IF (BNB-EMP-AFT-CONT = ZEROES)
042900         MOVE BEN-EMP-AFT-CONT       TO BNB-EMP-AFT-CONT.
043000     IF (BNB-PLAN-TYPE = "VA")
043100         IF (BNB-MULT-SALARY = ZEROES)
043200             MOVE BEN-NBR-HOURS      TO BNB-MULT-SALARY
043300         END-IF
043400     ELSE
043500         IF (BNB-PLAN-TYPE = "SB")
043600             IF (BNB-COVER-OPT = ZEROES)
043700                 MOVE BEN-NBR-PURCH  TO BNB-COVER-OPT
043800             END-IF
043900         ELSE
J31722             MOVE BNB-COMPANY        TO DB-COMPANY
J31722             MOVE BNB-PLAN-TYPE      TO DB-PLAN-TYPE
J31722             MOVE BNB-PLAN-CODE      TO DB-PLAN-CODE
J31722             PERFORM 840-FIND-PLNSET1
J31722             IF (PLAN-NOTFOUND)
J31722**************** Plan does not exist
J31722                 MOVE "BNBEN"        TO CRT-ERROR-CAT
J31722                 MOVE 103            TO CRT-ERROR-NBR
J31722                 GO TO 220-END
J31722             END-IF
044000             IF (PLN-CONTRIB-TYPE = "5")
044100                 IF (BNB-COVER-OPT = ZEROES)
044200                     MOVE BEN-CYCLES-REMAIN  TO BNB-COVER-OPT
044300                 END-IF
J31722                 IF (BNB-COVER-AMT = ZEROES)
J31722                     MOVE BEN-BOND-DED-AMT   TO BNB-COVER-AMT
J31722                 END-IF
044400             ELSE
044500                 IF (BNB-COVER-OPT = ZEROES)
044600                     MOVE BEN-COV-OPTION     TO BNB-COVER-OPT
J31722                 END-IF
J31722             END-IF
044700         END-IF
044800     END-IF.
044900     IF (BNB-COVER-AMT = ZEROES)
045000         MOVE BEN-COVER-AMT          TO BNB-COVER-AMT.
045100     IF (BNB-PAY-RATE = ZEROES)
045200         MOVE BEN-PAY-RATE           TO BNB-PAY-RATE.
045300     IF (BNB-PRE-AFT-FLAG = SPACES)
045400         MOVE BEN-PRE-AFT-FLAG       TO BNB-PRE-AFT-FLAG.
045500     IF (BNB-STOP-DATE = ZEROES)
045600         MOVE BEN-STOP-DATE          TO BNB-STOP-DATE.
045700     IF (BNB-PEND-EVIDENCE = SPACES)
045800         MOVE BEN-PEND-EVIDENCE      TO BNB-PEND-EVIDENCE.
045900     IF  (BNB-YTD-CONT = ZEROES)
046000     AND (BNB-PLAN-TYPE NOT = "RS" AND "SB" AND "SP")
046100         MOVE BEN-YTD-CONT           TO BNB-YTD-CONT.
P63803     IF  (BNB-EMP-YTD-CONT = ZEROES)
P63803     AND (BNB-PLAN-TYPE NOT = "RS" AND "SB" AND "SP")
P63803         MOVE BEN-EMP-YTD-CONT       TO BNB-EMP-YTD-CONT.
P63803
P63803     IF (BNB-EMP-YTD-CONT  > BNB-YTD-CONT)
P63803         MOVE 137                        TO CRT-ERROR-NBR
P63803         GO TO 220-END.
046200
046300     IF (BNB-FC = "D" OR "S")
046400         GO TO 220-END.
046500
046600     IF   (BEN-STOP-DATE          NOT = BNB-STOP-DATE)
046700     AND ((BEN-YTD-CONT           NOT = BNB-YTD-CONT)
P63803     OR   (BEN-EMP-YTD-CONT       NOT = BNB-EMP-YTD-CONT))
046800         MOVE 105                        TO CRT-ERROR-NBR
046900         GO TO 220-END.
047000
P63803     IF  (BEN-STOP-DATE          NOT = BNB-STOP-DATE)
P63803     AND (BEN-EMP-YTD-CONT       NOT = BNB-EMP-YTD-CONT)
P63803         MOVE 138                        TO CRT-ERROR-NBR
P63803         GO TO 220-END.

047100     IF (BEN-STOP-DATE           NOT = BNB-STOP-DATE)
047200         MOVE WS-TRUE            TO BN531WS-STOP-BENEFIT-SW
047300         MOVE WS-FALSE           TO BN531WS-STOP-CONT5-SW
047400         PERFORM 840-FIND-PLNSET1
047500         IF  (PLN-CONTRIB-TYPE = "5")
047600         AND (PLN-FLEX-PLAN NOT = SPACES)
047700             MOVE PLN-FLEX-PLAN  TO DB-FLEX-PLAN
047800             PERFORM 840-FIND-FLPSET1
047900             IF (FLP-SPEND-ONLY = "Y")
048000                 MOVE WS-TRUE    TO BN531WS-STOP-CONT5-SW
048100             END-IF
048200         END-IF
048300     END-IF.
048400
048500     IF (BEN-YTD-CONT            NOT = BNB-YTD-CONT)
P63803     OR (BEN-EMP-YTD-CONT        NOT = BNB-EMP-YTD-CONT)
048600         IF  (BEN-PLAN-TYPE       = "RS")
P12051             MOVE BNB-PLAN-TYPE      TO DB-PLAN-TYPE
P12051             MOVE BNB-PLAN-CODE      TO DB-PLAN-CODE
P12051             PERFORM 840-FIND-PLNSET1
048700             MOVE ZEROS          TO BN531WS-TOT-WITHDRAWALS
048800                                    DB-DATE
048900                                    DB-CHECK-NBR
049000             PERFORM 850-FIND-NLT-RTRSET2
049100             PERFORM
049200                 UNTIL (RESTRANS-NOTFOUND)
049300                 OR    (RTR-COMPANY    NOT = DB-COMPANY)
049400                 OR    (RTR-EMPLOYEE   NOT = DB-EMPLOYEE)
049500                 OR    (RTR-PLAN-CODE  NOT = DB-PLAN-CODE)
049600                 OR    (RTR-START-DATE NOT = DB-START-DATE)
049700
049800                     ADD RTR-TRANS-AMT TO BN531WS-TOT-WITHDRAWALS
049900                     PERFORM 860-FIND-NEXT-RTRSET2
050000             END-PERFORM
050100             IF  ((BNB-YTD-CONT     < BN531WS-TOT-WITHDRAWALS)
P63803             OR   (BNB-EMP-YTD-CONT < BN531WS-TOT-WITHDRAWALS))
P12051             AND (PLN-PAY-EXP-FLAG    = 2)
050200                 MOVE 106                TO CRT-ERROR-NBR
050300                 GO TO 220-END
050400             END-IF
050500         ELSE
050600         IF (BNB-PLAN-TYPE = "SB")
050700             MOVE BNB-PLAN-TYPE      TO DB-PLAN-TYPE
050800             MOVE BNB-PLAN-CODE      TO DB-PLAN-CODE
050900             PERFORM 840-FIND-PLNSET1
051000             IF ((BNB-YTD-CONT < (BEN-NBR-PURCH * PLN-BOND-COST))
P63803             OR  (BNB-EMP-YTD-CONT 
P63803                               < (BEN-NBR-PURCH * PLN-BOND-COST)))
051100                 MOVE 106                TO CRT-ERROR-NBR
051200                 GO TO 220-END
051300             END-IF
051400         ELSE
051500         IF (BNB-PLAN-TYPE = "SP")
051600             MOVE BNB-COMPANY     TO DB-COMPANY
051700             MOVE BNB-EMPLOYEE    TO DB-EMPLOYEE
051800             MOVE "SP"            TO DB-PLAN-TYPE
051900             MOVE BNB-PLAN-CODE   TO DB-PLAN-CODE
052000             MOVE BNB-START-DATE  TO DB-START-DATE
052100             MOVE ZEROS           TO DB-DATE-PURCH
052200                                     BN531WS-TOT-COST
052300             PERFORM 850-FIND-NLT-SPHSET1
052400
052500             PERFORM 
052600                 UNTIL (SPHIST-NOTFOUND)
052700                 OR    (SPH-COMPANY      NOT = DB-COMPANY)
052800                 OR    (SPH-EMPLOYEE     NOT = DB-EMPLOYEE)
052900                 OR    (SPH-PLAN-CODE    NOT = DB-PLAN-CODE)
053000                 OR    (SPH-START-DATE   NOT = DB-START-DATE)
053100
053200                 COMPUTE BN531WS-TOT-COST    =  BN531WS-TOT-COST
053300                                             + (SPH-NBR-SHARES
053400                                             *  SPH-SHARE-PRICE)
053500                 PERFORM 860-FIND-NEXT-SPHSET1
053600             END-PERFORM
053700             IF ((BNB-YTD-CONT     < BN531WS-TOT-COST)
P63803             OR  (BNB-EMP-YTD-CONT < BN531WS-TOT-COST))
053800                 MOVE 106                TO CRT-ERROR-NBR
053900                 GO TO 220-END
054000             END-IF
054100         END-IF
054200     END-IF.
054300
054400 220-END.
J83320******************************************************************
J83320 300-LOAD-FILE                   SECTION 10.
J83320******************************************************************
J83320 300-START.
J83320
J83320     IF (BN1-COMPANY NOT = PRM-COMPANY)
J83320         GO TO 300-NEXT.
J83320
J83320     IF (BN1-START-DATE NOT = ZEROES)
J83320         MOVE BN1-START-DATE        TO WSDR-FR-DATE
J83320         PERFORM 900-IS-DATE-INVALID
J83320         IF (WSDR-DATE-ERROR-EXISTS)
J83320             MOVE 109                    TO CRT-MSG-NBR
J83320             PERFORM 790-GET-MSG
J83320             MOVE BN1-START-DATE         TO HRWS-DATE-8-FIELD  
J83320             PERFORM 781-HR-FORMAT-DATE-FIELD
J83320             MOVE HRWS-VALUE             TO WS-FIELD-VALUE
J83320             MOVE BN1-EMPLOYEE           TO EL-EMPLOYEE
J83320             MOVE BN1-PLAN-TYPE          TO EL-PLAN-TYPE
J83320             MOVE BN1-PLAN-CODE          TO EL-PLAN-CODE
J83320             MOVE CRT-MESSAGE            TO WS-ERR-MSG
J83320             MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
J83320             MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
J83320             PERFORM 310-WRITE-BNBATCHERR
J83320             PERFORM 700-PRINT-RPT-GRP
J83320             GO TO 300-NEXT.
J83320  
J83320     IF  (PRM-THRU-DATE                  NOT = ZEROES)
J83320     AND (BN1-START-DATE                 > PRM-THRU-DATE)
J83320          GO TO 300-NEXT.
J83320
J83320     IF (BN1-COMPANY NOT = WS-BNB-COMPANY)
J83320         MOVE BN1-COMPANY            TO DB-COMPANY 
J83320         PERFORM 840-FIND-BNCSET1 
J83320         IF (BNCOMPANY-NOTFOUND)
J83320             MOVE BN1-COMPANY        TO CRT-ERR-VAR1
J83320             MOVE 100                TO CRT-MSG-NBR
J83320             PERFORM 790-GET-MSG
J83320             MOVE BN1-EMPLOYEE       TO EL-EMPLOYEE
J83320             MOVE BN1-PLAN-TYPE      TO EL-PLAN-TYPE
J83320             MOVE BN1-PLAN-CODE      TO EL-PLAN-CODE
J83320             MOVE CRT-MESSAGE        TO WS-ERR-MSG
J83320             MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
J83320             MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
J83320             PERFORM 700-PRINT-RPT-GRP
J83320             PERFORM 310-WRITE-BNBATCHERR
J83320             GO TO 300-NEXT
J83320         END-IF
J83320         MOVE BN1-COMPANY        TO G1-COMPANY
J83320                                    EH-COMPANY
J83320                                    DB-COMPANY
J83320         MOVE SPACES             TO DB-PROCESS-LEVEL
J83320         PERFORM 840-FIND-PRSSET1.
J83320
J83320     MOVE BN1-COMPANY         TO DB-COMPANY.
J83320     INITIALIZE DB-PROCESS-LEVEL.
J83320     PERFORM 840-FIND-PRSSET1.
J83320     IF (PRSYSTEM-NOTFOUND)
J83320         MOVE BN1-COMPANY        TO CRT-ERR-VAR1
J83320         MOVE 101                TO CRT-MSG-NBR
J83320         PERFORM 790-GET-MSG
J83320         MOVE BN1-EMPLOYEE       TO EL-EMPLOYEE
J83320         MOVE BN1-PLAN-TYPE      TO EL-PLAN-TYPE
J83320         MOVE BN1-PLAN-CODE      TO EL-PLAN-CODE
J83320         MOVE CRT-MESSAGE        TO WS-ERR-MSG
J83320         MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
J83320         MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
J83320         PERFORM 700-PRINT-RPT-GRP
J83320         PERFORM 310-WRITE-BNBATCHERR
J83320         GO TO 300-NEXT.
J83320
J83320     IF (BN1-EMPLOYEE NOT = WS-BNB-EMPLOYEE)
J83320         MOVE BN1-COMPANY            TO DB-COMPANY 
J83320         MOVE BN1-EMPLOYEE           TO DB-EMPLOYEE
J83320         PERFORM 840-FIND-EMPSET1 
J83320         IF (EMPLOYEE-NOTFOUND)
J83320             MOVE BN1-EMPLOYEE       TO CRT-ERR-VAR1
J83320             MOVE 102                TO CRT-MSG-NBR
J83320             PERFORM 790-GET-MSG
J83320             MOVE BN1-EMPLOYEE       TO EL-EMPLOYEE
J83320             MOVE BN1-PLAN-TYPE      TO EL-PLAN-TYPE
J83320             MOVE BN1-PLAN-CODE      TO EL-PLAN-CODE
J83320             MOVE CRT-MESSAGE        TO WS-ERR-MSG
J83320             MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
J83320             MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
J83320             PERFORM 700-PRINT-RPT-GRP
J83320             PERFORM 310-WRITE-BNBATCHERR
J83320             GO TO 300-NEXT.
J83320     
J83320     IF  (BNBINFO-ERROR     = "Y")
J83320     AND (BNBINFO-ERROR-NBR = 203)
J83320         MOVE 500                    TO CRT-MSG-NBR
J83320         MOVE BNBINFO-FIELD-NBR      TO CRT-ERR-VAR1
J83320         MOVE BNBINFO-RECORD-COUNT   TO CRT-ERR-VAR2
J83320         INSPECT CRT-ERR-VAR1 REPLACING LEADING "0" BY " "
J83320         INSPECT CRT-ERR-VAR2 REPLACING LEADING "0" BY " "
J83320         PERFORM 790-GET-MSG
J83320         MOVE CRT-MESSAGE            TO WS-ERR-MSG
J83320         MOVE BN1-EMPLOYEE           TO EL-EMPLOYEE
J83320         MOVE BN1-PLAN-TYPE          TO EL-PLAN-TYPE
J83320         MOVE BN1-PLAN-CODE          TO EL-PLAN-CODE
J83320         MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
J83320         MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
J83320         PERFORM 700-PRINT-RPT-GRP
J83320         PERFORM 310-WRITE-BNBATCHERR
J83320         GO TO 300-NEXT.
J83320
J83320     IF (BN1-ENROLLMENT-DATE NOT = ZEROES)
J83320         MOVE BN1-ENROLLMENT-DATE        TO WSDR-FR-DATE
J83320         PERFORM 900-IS-DATE-INVALID
J83320         IF (WSDR-DATE-ERROR-EXISTS)
J83320             MOVE 108                    TO CRT-MSG-NBR
J83320             PERFORM 790-GET-MSG
J83320             MOVE BN1-ENROLLMENT-DATE    TO HRWS-DATE-8-FIELD
J83320             PERFORM 781-HR-FORMAT-DATE-FIELD
J83320             MOVE HRWS-VALUE             TO WS-FIELD-VALUE
J83320             MOVE BN1-EMPLOYEE           TO EL-EMPLOYEE
J83320             MOVE BN1-PLAN-TYPE          TO EL-PLAN-TYPE
J83320             MOVE BN1-PLAN-CODE          TO EL-PLAN-CODE
J83320             MOVE CRT-MESSAGE            TO WS-ERR-MSG
J83320             MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
J83320             MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
J83320             PERFORM 310-WRITE-BNBATCHERR
J83320             PERFORM 700-PRINT-RPT-GRP
J83320             GO TO 300-NEXT.
J83320  
J83320     SET COMP-DATA                       TO TRUE.
J83320
J83320     IF (BN1-COMPANY NOT = WS-BNB-COMPANY)
J83320         MOVE BN1-COMPANY        TO WS-BNB-COMPANY
J83320         MOVE PRS-NAME           TO G1-PRS-NAME
J83320                                    EH-PRS-NAME
J83320         MOVE GN1-PAGE-HEADING   TO RPT-GROUP-REQUEST
J83320         PERFORM 700-PRINT-RPT-GRP
J83320         MOVE ERROR-HEADING      TO RPT-GROUP-REQUEST
J83320         PERFORM 700-PRINT-RPT-GRP.
J83320
J83320     IF (BN1-STOP-DATE NOT = ZEROES)
J83320         MOVE BN1-STOP-DATE              TO WSDR-FR-DATE
J83320         PERFORM 900-IS-DATE-INVALID
J83320         IF (WSDR-DATE-ERROR-EXISTS)
J83320             MOVE 110                    TO CRT-MSG-NBR
J83320             PERFORM 790-GET-MSG
J83320             MOVE BN1-STOP-DATE          TO HRWS-DATE-8-FIELD  
J83320             PERFORM 781-HR-FORMAT-DATE-FIELD
J83320             MOVE HRWS-VALUE             TO WS-FIELD-VALUE
J83320             MOVE BN1-EMPLOYEE           TO EL-EMPLOYEE
J83320             MOVE BN1-PLAN-TYPE          TO EL-PLAN-TYPE
J83320             MOVE BN1-PLAN-CODE          TO EL-PLAN-CODE
J83320             MOVE CRT-MESSAGE            TO WS-ERR-MSG
J83320             MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
J83320             MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
J83320             PERFORM 310-WRITE-BNBATCHERR
J83320             PERFORM 700-PRINT-RPT-GRP
J83320             GO TO 300-NEXT.
J83320  
J83320     IF  (BN1-YTD-CONT  NOT = ZEROES)
J83320     AND (BN1-PLAN-TYPE NOT = "RS" AND "SB" AND "SP")
J83320         MOVE 107                    TO CRT-MSG-NBR
J83320         PERFORM 790-GET-MSG
J83320         MOVE BN1-EMPLOYEE           TO EL-EMPLOYEE
J83320         MOVE BN1-PLAN-TYPE          TO EL-PLAN-TYPE
J83320         MOVE BN1-PLAN-CODE          TO EL-PLAN-CODE
J83320         MOVE CRT-MESSAGE            TO WS-ERR-MSG
J83320         MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
J83320         MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
J83320         PERFORM 310-WRITE-BNBATCHERR
J83320         PERFORM 700-PRINT-RPT-GRP
J83320         GO TO 300-NEXT.
J83320
J83320     IF  (BN1-EMP-YTD-CONT NOT = ZEROES)
J83320     AND (BN1-PLAN-TYPE NOT    = "RS" AND "SB" AND "SP")
J83320         MOVE 136                    TO CRT-MSG-NBR
J83320         PERFORM 790-GET-MSG
J83320         MOVE BN1-EMPLOYEE           TO EL-EMPLOYEE
J83320         MOVE BN1-PLAN-TYPE          TO EL-PLAN-TYPE
J83320         MOVE BN1-PLAN-CODE          TO EL-PLAN-CODE
J83320         MOVE CRT-MESSAGE            TO WS-ERR-MSG
J83320         MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
J83320         MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
J83320         PERFORM 310-WRITE-BNBATCHERR
J83320         PERFORM 700-PRINT-RPT-GRP
J83320         GO TO 300-NEXT.
J83320
J83320     IF  (BN1-PLAN-TYPE              NOT = "VA")
J83320     AND ((BN1-BTE-EMP-GROUP         NOT = SPACES)
J83320     OR   (BN1-BTE-POSITION          NOT = SPACES)
J83320     OR   (BN1-BTE-ALLOC-PCT         NOT = ZEROES))
J83320******** Not a VA plan; cannot enter EmpGrp, Pos, AllocPct
J83320         MOVE 113                    TO CRT-MSG-NBR
J83320         PERFORM 790-GET-MSG
J83320         MOVE BN1-EMPLOYEE           TO EL-EMPLOYEE
J83320         MOVE BN1-PLAN-TYPE          TO EL-PLAN-TYPE
J83320         MOVE BN1-PLAN-CODE          TO EL-PLAN-CODE
J83320         MOVE CRT-MESSAGE            TO WS-ERR-MSG
J83320         MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
J83320         MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
J83320         PERFORM 310-WRITE-BNBATCHERR
J83320         PERFORM 700-PRINT-RPT-GRP
J83320         GO TO 300-NEXT.
J83320
J83320     IF  (BN1-BTE-EMP-GROUP          = SPACES)
J83320     AND (BN1-BTE-POSITION           NOT = SPACES)
J83320******** Must enter employee group when entering position
J83320         MOVE 114                    TO CRT-MSG-NBR
J83320         PERFORM 790-GET-MSG
J83320         MOVE BN1-EMPLOYEE           TO EL-EMPLOYEE
J83320         MOVE BN1-PLAN-TYPE          TO EL-PLAN-TYPE
J83320         MOVE BN1-PLAN-CODE          TO EL-PLAN-CODE
J83320         MOVE CRT-MESSAGE            TO WS-ERR-MSG
J83320         MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
J83320         MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
J83320         PERFORM 310-WRITE-BNBATCHERR
J83320         PERFORM 700-PRINT-RPT-GRP
J83320         GO TO 300-NEXT.
J83320
J83320     IF  (BN1-BTE-ALLOC-PCT          NOT = ZEROES)
J83320     AND (BN1-BTE-EMP-GROUP          = SPACES)
J83320******** Must enter key to absence plan master record
J83320         MOVE 115                    TO CRT-MSG-NBR
J83320         PERFORM 790-GET-MSG
J83320         MOVE BN1-EMPLOYEE           TO EL-EMPLOYEE
J83320         MOVE BN1-PLAN-TYPE          TO EL-PLAN-TYPE
J83320         MOVE BN1-PLAN-CODE          TO EL-PLAN-CODE
J83320         MOVE CRT-MESSAGE            TO WS-ERR-MSG
J83320         MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
J83320         MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
J83320         PERFORM 310-WRITE-BNBATCHERR
J83320         PERFORM 700-PRINT-RPT-GRP
J83320         GO TO 300-NEXT.
J83320
J83320     IF (BN1-DED-START-DATE NOT = ZEROES)
J83320         MOVE BN1-DED-START-DATE        TO WSDR-FR-DATE
J83320         PERFORM 900-IS-DATE-INVALID
J83320         IF (WSDR-DATE-ERROR-EXISTS)
J83320             MOVE 123                    TO CRT-MSG-NBR
J83320             PERFORM 790-GET-MSG
J83320             MOVE BN1-DED-START-DATE     TO HRWS-DATE-8-FIELD
J83320             PERFORM 781-HR-FORMAT-DATE-FIELD
J83320             MOVE HRWS-VALUE             TO WS-FIELD-VALUE
J83320             MOVE BN1-EMPLOYEE           TO EL-EMPLOYEE
J83320             MOVE BN1-PLAN-TYPE          TO EL-PLAN-TYPE
J83320             MOVE BN1-PLAN-CODE          TO EL-PLAN-CODE
J83320             MOVE CRT-MESSAGE            TO WS-ERR-MSG
J83320             MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
J83320             MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
J83320             PERFORM 310-WRITE-BNBATCHERR
J83320             PERFORM 700-PRINT-RPT-GRP
J83320             GO TO 300-NEXT.
J83320  
J83320     IF (BN1-DED-STOP-DATE NOT = ZEROES)
J83320         MOVE BN1-DED-STOP-DATE        TO WSDR-FR-DATE
J83320         PERFORM 900-IS-DATE-INVALID
J83320         IF (WSDR-DATE-ERROR-EXISTS)
J83320             MOVE 124                    TO CRT-MSG-NBR
J83320             PERFORM 790-GET-MSG
J83320             MOVE BN1-DED-STOP-DATE      TO HRWS-DATE-8-FIELD
J83320             PERFORM 781-HR-FORMAT-DATE-FIELD
J83320             MOVE HRWS-VALUE             TO WS-FIELD-VALUE
J83320             MOVE BN1-EMPLOYEE           TO EL-EMPLOYEE
J83320             MOVE BN1-PLAN-TYPE          TO EL-PLAN-TYPE
J83320             MOVE BN1-PLAN-CODE          TO EL-PLAN-CODE
J83320             MOVE CRT-MESSAGE            TO WS-ERR-MSG
J83320             MOVE WS-ERROR-MESSAGE       TO EL-MESSAGE
J83320             MOVE ERROR-LINE             TO RPT-GROUP-REQUEST
J83320             PERFORM 310-WRITE-BNBATCHERR
J83320             PERFORM 700-PRINT-RPT-GRP
J83320             GO TO 300-NEXT.
J83320  
J83320* Upper Case Translations
J83320
J83320     MOVE BN1-FC                     TO HRWS-UP-FIELD.
J83320     PERFORM 760-HR-UPPER-CASE.
J83320     MOVE HRWS-UP-FIELD              TO BN1-FC. 
J83320
J83320     IF (BN1-FC                 NOT = "A" AND "C" AND "D" AND "S")
J83320         MOVE BN1-FC             TO CRT-ERR-VAR1
J83320         MOVE 111                TO CRT-MSG-NBR
J83320         PERFORM 790-GET-MSG
J83320         MOVE BN1-EMPLOYEE       TO EL-EMPLOYEE
J83320         MOVE BN1-PLAN-TYPE      TO EL-PLAN-TYPE
J83320         MOVE BN1-PLAN-CODE      TO EL-PLAN-CODE
J83320         MOVE CRT-MESSAGE        TO WS-ERR-MSG
J83320         MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
J83320         MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
J83320         PERFORM 700-PRINT-RPT-GRP
J83320         PERFORM 310-WRITE-BNBATCHERR
J83320         GO TO 300-NEXT.
J83320
J83320     IF (BN1-PLAN-TYPE NOT = SPACES)
J83320         MOVE BN1-PLAN-TYPE          TO HRWS-UP-FIELD
J83320         PERFORM 760-HR-UPPER-CASE
J83320         MOVE HRWS-UP-FIELD          TO BN1-PLAN-TYPE.
J83320
J83320     IF (BN1-PCT-AMT-FLAG NOT = SPACES)
J83320         MOVE BN1-PCT-AMT-FLAG       TO HRWS-UP-FIELD
J83320         PERFORM 760-HR-UPPER-CASE
J83320         MOVE HRWS-UP-FIELD          TO BN1-PCT-AMT-FLAG.
J83320
J83320     IF (BN1-PCT-AMT-FLAG        NOT = "P" AND "A" AND SPACES)
J83320         MOVE BN1-PCT-AMT-FLAG   TO CRT-ERR-VAR1
J83320         MOVE 125                TO CRT-MSG-NBR
J83320         PERFORM 790-GET-MSG
J83320         MOVE BN1-EMPLOYEE       TO EL-EMPLOYEE
J83320         MOVE BN1-PLAN-TYPE      TO EL-PLAN-TYPE
J83320         MOVE BN1-PLAN-CODE      TO EL-PLAN-CODE
J83320         MOVE CRT-MESSAGE        TO WS-ERR-MSG
J83320         MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
J83320         MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
J83320         PERFORM 700-PRINT-RPT-GRP
J83320         PERFORM 310-WRITE-BNBATCHERR
J83320         GO TO 300-NEXT.
J83320
J83320     IF (BN1-PRE-AFT-FLAG NOT = SPACES)
J83320         MOVE BN1-PRE-AFT-FLAG       TO HRWS-UP-FIELD
J83320         PERFORM 760-HR-UPPER-CASE
J83320         MOVE HRWS-UP-FIELD          TO BN1-PRE-AFT-FLAG.
J83320
J83320     IF (BN1-PRE-AFT-FLAG        NOT = "P" AND "A" AND "B"
J83320                                           AND "N" AND SPACES)
J83320         MOVE BN1-PCT-AMT-FLAG   TO CRT-ERR-VAR1
J83320         MOVE 126                TO CRT-MSG-NBR
J83320         PERFORM 790-GET-MSG
J83320         MOVE BN1-EMPLOYEE       TO EL-EMPLOYEE
J83320         MOVE BN1-PLAN-TYPE      TO EL-PLAN-TYPE
J83320         MOVE BN1-PLAN-CODE      TO EL-PLAN-CODE
J83320         MOVE CRT-MESSAGE        TO WS-ERR-MSG
J83320         MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
J83320         MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
J83320         PERFORM 700-PRINT-RPT-GRP
J83320         PERFORM 310-WRITE-BNBATCHERR
J83320         GO TO 300-NEXT.
J83320
J83320     IF (BN1-SMOKER-FLAG NOT = SPACES)
J83320         MOVE BN1-SMOKER-FLAG        TO HRWS-UP-FIELD
J83320         PERFORM 760-HR-UPPER-CASE
J83320         MOVE HRWS-UP-FIELD          TO BN1-SMOKER-FLAG.
J83320
J83320     IF (BN1-SMOKER-FLAG         NOT = "N" AND "Y" AND SPACES)
J83320         MOVE BN1-SMOKER-FLAG    TO CRT-ERR-VAR1
J83320         MOVE 127                TO CRT-MSG-NBR
J83320         PERFORM 790-GET-MSG
J83320         MOVE BN1-EMPLOYEE       TO EL-EMPLOYEE
J83320         MOVE BN1-PLAN-TYPE      TO EL-PLAN-TYPE
J83320         MOVE BN1-PLAN-CODE      TO EL-PLAN-CODE
J83320         MOVE CRT-MESSAGE        TO WS-ERR-MSG
J83320         MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
J83320         MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
J83320         PERFORM 700-PRINT-RPT-GRP
J83320         PERFORM 310-WRITE-BNBATCHERR
J83320         GO TO 300-NEXT.
J83320
J83320     IF (BN1-PEND-EVIDENCE NOT = SPACES)
J83320         MOVE BN1-PEND-EVIDENCE      TO HRWS-UP-FIELD
J83320         PERFORM 760-HR-UPPER-CASE
J83320         MOVE HRWS-UP-FIELD          TO BN1-PEND-EVIDENCE.
J83320
J83320     IF (BN1-PEND-EVIDENCE       NOT = "N" AND "A" AND "P"
J83320                                                   AND SPACES)
J83320         MOVE BN1-PEND-EVIDENCE  TO CRT-ERR-VAR1
J83320         MOVE 128                TO CRT-MSG-NBR
J83320         PERFORM 790-GET-MSG
J83320         MOVE BN1-EMPLOYEE       TO EL-EMPLOYEE
J83320         MOVE BN1-PLAN-TYPE      TO EL-PLAN-TYPE
J83320         MOVE BN1-PLAN-CODE      TO EL-PLAN-CODE
J83320         MOVE CRT-MESSAGE        TO WS-ERR-MSG
J83320         MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
J83320         MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
J83320         PERFORM 700-PRINT-RPT-GRP
J83320         PERFORM 310-WRITE-BNBATCHERR
J83320         GO TO 300-NEXT.
J83320
J83320     IF (BN1-BTE-EMP-GROUP NOT = SPACES)
J83320         MOVE BN1-BTE-EMP-GROUP      TO HRWS-UP-FIELD
J83320         PERFORM 760-HR-UPPER-CASE
J83320         MOVE HRWS-UP-FIELD          TO BN1-BTE-EMP-GROUP.
J83320
J83320     IF (BN1-BTE-POSITION NOT = SPACES)
J83320         MOVE BN1-BTE-POSITION       TO HRWS-UP-FIELD
J83320         PERFORM 760-HR-UPPER-CASE
J83320         MOVE HRWS-UP-FIELD          TO BN1-BTE-POSITION.
J83320
J83320     MOVE WS-FALSE                   TO BN531WS-STOP-BENEFIT-SW
J83320                                        BN531WS-STOP-CONT5-SW.
J83320
J83320     IF (BN1-FC = "C" OR "D" OR "S")
J83320         MOVE WS-FALSE           TO BN531WS-STOP-BENEFIT-SW
J83320         PERFORM 320-EDIT-INPUT-DATA
J83320         IF (ERROR-FOUND)
J83320             MOVE CRT-ERROR-NBR      TO CRT-MSG-NBR
J83320             MOVE ZEROS              TO CRT-ERROR-NBR
J83320             PERFORM 790-GET-MSG
J83320             MOVE BN1-EMPLOYEE       TO EL-EMPLOYEE
J83320             MOVE BN1-PLAN-TYPE      TO EL-PLAN-TYPE
J83320             MOVE BN1-PLAN-CODE      TO EL-PLAN-CODE
J83320             MOVE CRT-MESSAGE        TO WS-ERR-MSG
J83320             MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
J83320             MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
J83320             PERFORM 310-WRITE-BNBATCHERR
J83320             PERFORM 700-PRINT-RPT-GRP
J83320             GO TO 300-NEXT.
J83320
J83320     INITIALIZE BNBEN-DETAIL-GROUP
J83320                BNBEN-USE-NAVIGATE-SW.
J83320 
J83320     IF (BN1-FC                  = "D")
J83320         MOVE "C"                TO BNBEN-FC
J83320     ELSE
J83320         MOVE BN1-FC             TO BNBEN-FC.
J83320     MOVE 1                      TO BNBEN-FC-FN.
J83320     MOVE BN1-COMPANY            TO BNBEN-COMPANY.
J83320     MOVE 2                      TO BNBEN-COMPANY-FN.
J83320     MOVE BN1-ENROLLMENT-DATE    TO BNBEN-ENROLLMENT-DATE.
J83320     MOVE 3                      TO BNBEN-ENROLLMENT-DATE-FN.
J83320     MOVE 1                      TO BNBEN-NBR-LINES.           
J83320     IF (BN531WS-STOP-BENEFIT)
J83320         MOVE "S"                TO BNBEN-LINE-FC (1)
J83320     ELSE
J83320         MOVE BN1-FC             TO BNBEN-LINE-FC (1).
J83320     MOVE 4                      TO BNBEN-LINE-FC-FN (1).
J83320     MOVE BN1-EMPLOYEE           TO BNBEN-EMPLOYEE (1).
J83320     MOVE 5                      TO BNBEN-EMPLOYEE-FN (1).
J83320     MOVE BN1-PLAN-TYPE          TO BNBEN-PLAN-TYPE (1).
J83320     MOVE 6                      TO BNBEN-PLAN-TYPE-FN (1).
J83320     MOVE BN1-PLAN-CODE          TO BNBEN-PLAN-CODE (1).
J83320     MOVE 7                      TO BNBEN-PLAN-CODE-FN (1).
J83320     MOVE BN1-COVER-OPT          TO BNBEN-COVER-OPT (1).
J83320     MOVE 8                      TO BNBEN-COVER-OPT-FN (1).
J83320     MOVE BN1-MULT-SALARY        TO BNBEN-MULT-SALARY (1).
J83320     MOVE BN1-COVER-AMT          TO BNBEN-COVER-AMT (1).
J83320     MOVE BN1-PAY-RATE           TO BNBEN-PAY-RATE (1).
J83320     MOVE 9                      TO BNBEN-PAY-RATE-FN (1).
J83320     MOVE BN1-PCT-AMT-FLAG       TO BNBEN-PCT-AMT-FLAG (1).
J83320     MOVE BN1-START-DATE         TO BNBEN-START-DATE (1).
J83320     IF (BNBEN-LINE-FC (1) = "C" OR "D" OR "S")
J83320         MOVE BN1-START-DATE     TO BNBEN-PT-START-DATE (1).
J83320
J83320*    IF  (BN1-START-DATE      = ZEROES)
J83320*    AND (BN1-ENROLLMENT-DATE NOT = ZEROES)
J83320*        MOVE BN1-ENROLLMENT-DATE TO BNBEN-START-DATE (1).
J83320
J83320     MOVE 10                     TO BNBEN-START-DATE-FN (1).
J83320     MOVE BN1-PRE-AFT-FLAG       TO BNBEN-PRE-AFT-FLAG (1).
J83320     MOVE BN1-SMOKER-FLAG        TO BNBEN-SMOKER-FLAG (1).
J83320     MOVE BN1-EMP-PRE-CONT       TO BNBEN-EMP-PRE-CONT (1).
J83320     MOVE 11                     TO BNBEN-EMP-PRE-CONT-FN (1).
J83320     MOVE BN1-EMP-AFT-CONT       TO BNBEN-EMP-AFT-CONT (1).
J83320     MOVE 12                     TO BNBEN-EMP-AFT-CONT-FN (1).
J83320     MOVE BN531WS-EMP-COMP-CONT  TO BNBEN-COMP-CONT (1).
J83320     MOVE BN1-STOP-DATE          TO BNBEN-STOP-DATE (1).
J83320     MOVE 13                     TO BNBEN-STOP-DATE-FN (1).
J83320     MOVE BN1-PEND-EVIDENCE      TO BNBEN-PEND-EVIDENCE (1).
060209     IF  (BN1-PEND-EVIDENCE      = SPACES)
060209          MOVE "N"               TO BNBEN-PEND-EVIDENCE (1)
060209     END-IF.
J83320     MOVE BN1-YTD-CONT           TO BNBEN-YTD-CONT (1).
J83320     MOVE BN1-EMP-YTD-CONT       TO BNBEN-EMP-YTD-CONT (1).
J83320     MOVE BN1-CREATION-DATE      TO BNBEN-CREATION-DATE (1).
J83320     MOVE BN1-UPD-DATE           TO BNBEN-UPD-DATE (1).
J83320     MOVE BN1-TIME-STAMP         TO BNBEN-TIME-STAMP (1).
J83320     MOVE BN1-USER-ID            TO BNBEN-USER-ID (1).
J83320     MOVE BN1-CREATE-TRANS       TO BNBEN-CREATE-TRANS (1).
J83320     MOVE BN1-REASON             TO BNBEN-REASON (1).
J83320     MOVE BN1-MEMBER-ID          TO BNBEN-MEMBER-ID (1).
J83320     MOVE BN1-BTE-EMP-GROUP      TO BNBEN-BTE-EMP-GRP (1).
J83320     MOVE BN1-BTE-POSITION       TO BNBEN-BTE-POSITION (1).
J83320     MOVE BN1-BTE-ALLOC-PCT      TO BNBEN-BTE-ALLOC-PCT (1).
J83320     MOVE BN1-DED-START-DATE     TO BNBEN-DED-START-DATE (1).
J83320     MOVE BN1-DED-STOP-DATE      TO BNBEN-DED-STOP-DATE (1).
J83320     IF (BN1-STOP-DATE       NOT = ZEROES)
J83320         MOVE BN1-STOP-DATE      TO BNBEN-PRE-STOP-DATE (1)
J83320     END-IF.
J83320     IF (BN1-DED-START-DATE  NOT = ZEROES)
J83320         MOVE BN1-DED-START-DATE TO BNBEN-PRE-DED-START-DATE (1)
J83320     END-IF.
J83320     IF (BN1-DED-STOP-DATE   NOT = ZEROES)
J83320         MOVE BN1-DED-STOP-DATE  TO BNBEN-PRE-DED-STOP-DATE (1)
J83320     END-IF.
J83320
J83320     IF (BN531WS-STOP-CONT5)
J83320         MOVE ZEROES             TO BNBEN-COVER-OPT (1)
J83320                                    BNBEN-PAY-RATE (1).
J83320     MOVE BN1-WEB-UPDATE         TO BNBEN-WEB-UPDATE.
J83320     IF  (BN1-WEB-UPDATE = "Y")
J83320         IF  (BN1-RULE-TYPE     = SPACES)
J83320         OR  (BN1-FAMILY-STATUS = SPACES)
J83320         OR  (BN1-ENROLL-DATE   = ZEROS)
J83320             MOVE "N"                TO BNBEN-WEB-UPDATE
J83320         ELSE
J83320         IF  (BN1-FAMILY-STATUS NOT = "ANNUAL" AND "NEW HIRE" AND
J83320                                      "BIRTH"  AND "ADOPTION" AND
J83320                                      "MOVE"   AND "MARRIAGE" AND
J83320                                      "LEGAL SEP" AND 
J83320                                      "SPS CHANGE")
J83320             MOVE "N"                TO BNBEN-WEB-UPDATE
J83320         ELSE
J83320             MOVE BN1-RULE-TYPE      TO BNBEN-RULE-TYPE
J83320             MOVE BN1-FAMILY-STATUS  TO BNBEN-FAMILY-STATUS
J83320             MOVE BN1-ENROLL-DATE    TO BNBEN-NEW-DATE
J83320         END-IF
J83320         END-IF
J83320     ELSE
J83320         MOVE SPACES             TO BNBEN-RULE-TYPE
J83320         MOVE SPACES             TO BNBEN-FAMILY-STATUS
J83320         MOVE ZEROES             TO BNBEN-NEW-DATE
J83320     END-IF.
J83320     IF  (PRM-UPDATE-ACA = "1")   
J83320         MOVE "N"                TO BNBEN-UPDATE-ACA.
J83320     IF  (PRM-UPDATE-ACA = "2")   
J83320         MOVE "Y"                TO BNBEN-UPDATE-ACA.
J83320
J83320     PERFORM 2000-BNBEN-EDIT-TRAN.
J83320
J83320     IF (ERROR-FOUND)
J83320         IF (CRT-ERROR-NBR       = 311)
J83320************ Warning:Record updated; Change will affect YTD amount
J83320             MOVE CRT-ERROR-NBR      TO CRT-MSG-NBR
J83320             INITIALIZE CRT-ERROR-NBR
J83320                        CRT-ERROR-CAT
J83320                        CRT-ERR-VAR1
J83320                        CRT-ERR-VAR2
J83320                        CRT-ERR-VAR3
J83320                        CRT-ERR-VAR4
J83320                        CRT-ERR-VAR5
J83320             PERFORM 790-GET-MSG
J83320             MOVE BN1-EMPLOYEE       TO EL-EMPLOYEE
J83320             MOVE BN1-PLAN-TYPE      TO EL-PLAN-TYPE
J83320             MOVE BN1-PLAN-CODE      TO EL-PLAN-CODE
J83320             MOVE CRT-MESSAGE        TO WS-ERR-MSG
J83320             MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
J83320             MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
J83320             PERFORM 700-PRINT-RPT-GRP
J83320         ELSE
J83320             MOVE CRT-ERROR-NBR      TO CRT-MSG-NBR
J83320             IF (CRT-ERROR-NBR       = 113)
J83320                 MOVE WS-TRUE        TO BN531WS-ERR-SW
J83320             END-IF
J83320             MOVE ZEROS              TO CRT-ERROR-NBR
J83320             PERFORM 790-GET-MSG
J83320             MOVE BN1-EMPLOYEE       TO EL-EMPLOYEE
J83320             MOVE BN1-PLAN-TYPE      TO EL-PLAN-TYPE
J83320             MOVE BN1-PLAN-CODE      TO EL-PLAN-CODE
J83320             MOVE CRT-MESSAGE        TO WS-ERR-MSG
J83320             MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
J83320             MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
J83320             PERFORM 310-WRITE-BNBATCHERR
J83320             PERFORM 700-PRINT-RPT-GRP
J83320             GO TO 300-NEXT.
J83320
J83320     IF  (BNBEN-COV-OVER-FLG (1) = "Y")
J83320     AND (PLN-COVERAGE-TYPE      = "2")
J83320******** Warning: Salary has been overridden for this benefit
J83320         MOVE 112                TO CRT-MSG-NBR
J83320         INITIALIZE CRT-ERROR-NBR
J83320         PERFORM 790-GET-MSG
J83320         MOVE BN1-EMPLOYEE       TO EL-EMPLOYEE
J83320         MOVE BN1-PLAN-TYPE      TO EL-PLAN-TYPE
J83320         MOVE BN1-PLAN-CODE      TO EL-PLAN-CODE
J83320         MOVE CRT-MESSAGE        TO WS-ERR-MSG
J83320         MOVE WS-ERROR-MESSAGE   TO EL-MESSAGE
J83320         MOVE ERROR-LINE         TO RPT-GROUP-REQUEST
J83320         PERFORM 700-PRINT-RPT-GRP.
J83320
J83320     MOVE BNBEN-EMPLOYEE (1)     TO G2-EMPLOYEE.
J83320     MOVE EMP-LAST-NAME          TO HRWS-LAST-NAME.
J83320     MOVE EMP-FIRST-NAME         TO HRWS-FIRST-NAME.
J83320     MOVE EMP-MIDDLE-INIT        TO HRWS-MIDDLE-INIT.
J83320     MOVE EMP-LAST-NAME-PRE      TO HRWS-LAST-NAME-PRE.
J83320     MOVE EMP-NAME-SUFFIX        TO HRWS-NAME-SUFFIX.
J83320     PERFORM 750-HR-FORMAT-NAME.
J83320     MOVE HRWS-FORMAT-NAME       TO G2-SHORT-NAME.
J83320     MOVE BNBEN-PLAN-TYPE (1)    TO G2-PLAN-TYPE.
J83320     MOVE BNBEN-PLAN-CODE (1)    TO G2-PLAN-CODE.
J83320     MOVE BNBEN-COVER-OPT (1)    TO G2-COVER-OPT.
J83320     MOVE BNBEN-MULT-SALARY (1)  TO G2-MULT-SALARY.
J83320     MOVE BNBEN-COVER-AMT (1)    TO G2-COVER-AMT.
J83320     MOVE BNBEN-PAY-RATE (1)     TO G2-PAY-RATE.
J83320     MOVE BNBEN-PCT-AMT-FLAG (1) TO G2-PCT-AMT-FLAG.
J83320     MOVE BNBEN-START-DATE (1)   TO G2-START-DATE.
J83320     MOVE BNBEN-PRE-AFT-FLAG (1) TO G2-PRE-AFT-FLAG.
J83320     MOVE BNBEN-SMOKER-FLAG (1)  TO G2-SMOKER-FLAG.
J83320     MOVE BNBEN-EMP-PRE-CONT (1) TO G2-EMP-PRE-CONT.
J83320     MOVE BNBEN-EMP-AFT-CONT (1) TO G2-EMP-AFT-CONT.
J83320     MOVE BNBEN-CMP-FLX-CONT (1) TO G2-CMP-FLX-CONT.
J83320     MOVE BNBEN-COMP-CONT (1)    TO G2-COMP-CONT.
J83320     MOVE BNBEN-STOP-DATE (1)    TO G3-STOP-DATE.
J83320     MOVE BNBEN-YTD-CONT (1)     TO G2-YTD-CONT.
J83320     MOVE GN2-BENEFIT            TO RPT-GROUP-REQUEST.
J83320     PERFORM 700-PRINT-RPT-GRP.
J83320
J83320     INITIALIZE G3-DED-CMP-FLX-CONT
J83320                G3-DED-EMP-PRE-CONT
J83320                G3-DED-EMP-AFT-CONT
J83320                G3-DED-COMP-CONT.
J83320
J83320     IF (PRM-UPDATE-OPTION               = "1")
J83320         IF (G3-STOP-DATE                NOT = ZEROES)
J83320             MOVE 116                    TO CRT-MSG-NBR
J83320             PERFORM 790-GET-MSG
J83320             MOVE CRT-MESSAGE            TO G3-STOP-TITLE
J83320             MOVE GN3-DEDUCTION          TO RPT-GROUP-REQUEST
J83320             PERFORM 700-PRINT-RPT-GRP
J83320         END-IF
J83320     ELSE
J83320         IF  (BN1-FC NOT = "D")
J83320             PERFORM 4000-BNBEN-PROCESS-TRAN
J83320             ADD 1                       TO WS-RECORD-COUNT
J83320             ADD 3                       TO WS-UPDATE-COUNT
J83320             IF  (WS-UPDATE-COUNT         > WS-MAX-OPS-IN-TRAN)
J83320                 PERFORM 840-MODIFY-CKPSET1
J83320                 MOVE WS-RESTART-DATA    TO CKP-RESTART-INFO
J83320                 PERFORM 820-STORE-CKPOINT
J83320                 INITIALIZE WS-UPDATE-COUNT
J83320                 PERFORM 925-AUDIT-END
J83320                 PERFORM 910-AUDIT-BEGIN
J83320             END-IF
J83320         END-IF
J83320
J83320         IF  (BEN-CMP-FLX-CONT           NOT = ZEROES)
J83320         AND (BEN-FLEX-DED-SEQ           NOT = ZEROES)
J83320             MOVE BEN-COMPANY            TO DB-COMPANY
J83320             MOVE BEN-EMPLOYEE           TO DB-EMPLOYEE
J83320             MOVE PLN-FLEX-DED-CODE      TO DB-DED-CODE
J83320             MOVE BEN-FLEX-DED-SEQ       TO DB-SEQ-NBR
J83320             PERFORM 840-FIND-EDMSET1
J83320             MOVE EDM-NEXT-AMOUNT        TO G3-DED-CMP-FLX-CONT
J83320         END-IF
J83320
J83320         IF (BEN-EMP-PRE-CONT            NOT = ZEROES)
J83320             MOVE BEN-COMPANY            TO DB-COMPANY
J83320             MOVE BEN-EMPLOYEE           TO DB-EMPLOYEE
J83320             IF (BEN-PCT-AMT-FLAG        = "A")
J83320                 MOVE PLN-PRE-DED-CODE-A TO DB-DED-CODE
J83320             ELSE
J83320                 MOVE PLN-PRE-DED-CODE-P TO DB-DED-CODE
J83320             END-IF
J83320             MOVE BEN-PRE-SEQ-NBR        TO DB-SEQ-NBR
J83320             PERFORM 840-FIND-EDMSET1
J83320             IF (EMDEDMASTR-FOUND)
J83320                 MOVE EDM-NEXT-AMOUNT    TO G3-DED-EMP-PRE-CONT
J83320             END-IF
J83320         END-IF
J83320
J83320         IF (BEN-EMP-AFT-CONT            NOT = ZEROES)
J83320             MOVE BEN-COMPANY            TO DB-COMPANY
J83320             MOVE BEN-EMPLOYEE           TO DB-EMPLOYEE
J83320             IF (BEN-PCT-AMT-FLAG        = "A")
J83320                 MOVE PLN-AFT-DED-CODE-A TO DB-DED-CODE
J83320             ELSE
J83320                 MOVE PLN-AFT-DED-CODE-P TO DB-DED-CODE
J83320             END-IF
J83320             MOVE BEN-AFT-SEQ-NBR        TO DB-SEQ-NBR
J83320             PERFORM 840-FIND-EDMSET1
J83320             IF (EMDEDMASTR-FOUND)
J83320                 MOVE EDM-NEXT-AMOUNT    TO G3-DED-EMP-AFT-CONT
J83320             END-IF
J83320         END-IF
J83320
J83320         IF (BEN-COMP-CONT               NOT = ZEROES)
J83320             MOVE BEN-COMPANY            TO DB-COMPANY
J83320             MOVE BEN-EMPLOYEE           TO DB-EMPLOYEE
J83320             IF (BEN-PCT-AMT-FLAG        = "P")
J83320                 MOVE PLN-CMP-DED-CODE-P TO DB-DED-CODE
J83320             ELSE
J83320                 MOVE PLN-CMP-DED-CODE-A TO DB-DED-CODE
J83320             END-IF
J83320             MOVE BEN-CMP-SEQ-NBR        TO DB-SEQ-NBR
J83320             PERFORM 840-FIND-EDMSET1
J83320             IF (EMDEDMASTR-NOTFOUND)
J83320                 IF (BEN-PCT-AMT-FLAG    = "A")
J83320                     IF (BEN-PRE-AFT-FLAG = "P")
J83320                         MOVE PLN-PRE-DED-MTCH-A TO DB-DED-CODE
J83320                         MOVE BEN-CMP-SEQ-NBR    TO DB-SEQ-NBR
J83320                     ELSE
J83320                         MOVE PLN-AFT-DED-MTCH-A TO DB-DED-CODE
J83320                         MOVE BEN-CMP-AFT-SEQ    TO DB-SEQ-NBR
J83320                     END-IF
J83320                 ELSE
J83320                     IF (BEN-PRE-AFT-FLAG = "P")
J83320                         MOVE PLN-PRE-DED-MTCH-P TO DB-DED-CODE
J83320                         MOVE BEN-CMP-SEQ-NBR    TO DB-SEQ-NBR
J83320                     ELSE
J83320                         MOVE PLN-AFT-DED-MTCH-P TO DB-DED-CODE
J83320                         MOVE BEN-CMP-AFT-SEQ    TO DB-SEQ-NBR
J83320                     END-IF
J83320                 END-IF
J83320                 PERFORM 840-FIND-EDMSET1
J83320             END-IF
J83320             IF (EMDEDMASTR-FOUND)
J83320                 MOVE EDM-NEXT-AMOUNT        TO G3-DED-COMP-CONT
J83320             END-IF
J83320         END-IF
J83320
J83320         IF  (BN1-FC = "D")
J83320             PERFORM 4000-BNBEN-PROCESS-TRAN
J83320             ADD 1                       TO WS-RECORD-COUNT
J83320             ADD 3                       TO WS-UPDATE-COUNT
J83320             IF  (WS-UPDATE-COUNT         > WS-MAX-OPS-IN-TRAN)
J83320                 PERFORM 840-MODIFY-CKPSET1
J83320                 MOVE WS-RESTART-DATA    TO CKP-RESTART-INFO
J83320                 PERFORM 820-STORE-CKPOINT
J83320                 INITIALIZE WS-UPDATE-COUNT
J83320                 PERFORM 925-AUDIT-END
J83320                 PERFORM 910-AUDIT-BEGIN
J83320             END-IF
J83320         END-IF
J83320
J83320         INITIALIZE G3-STOP-TITLE
J83320         IF (G3-DED-CMP-FLX-CONT         NOT = ZEROES)
J83320         OR (G3-DED-EMP-PRE-CONT         NOT = ZEROES)
J83320         OR (G3-DED-EMP-AFT-CONT         NOT = ZEROES)
J83320         OR (G3-DED-COMP-CONT            NOT = ZEROES)
J83320         OR (G3-STOP-DATE                NOT = ZEROES)
J83320             IF (G3-STOP-DATE            NOT = ZEROES)
J83320                 MOVE 116                TO CRT-MSG-NBR
J83320                 PERFORM 790-GET-MSG
J83320                 MOVE CRT-MESSAGE        TO G3-STOP-TITLE
J83320             END-IF
J83320             IF (G3-DED-CMP-FLX-CONT     NOT = ZEROES)
J83320             OR (G3-DED-EMP-PRE-CONT     NOT = ZEROES)
J83320             OR (G3-DED-EMP-AFT-CONT     NOT = ZEROES)
J83320             OR (G3-DED-COMP-CONT        NOT = ZEROES)
J83320                 MOVE 117                TO CRT-MSG-NBR
J83320                 PERFORM 790-GET-MSG
J83320                 MOVE CRT-MESSAGE        TO G3-DED-TITLE
J83320             END-IF
J83320             MOVE GN3-DEDUCTION          TO RPT-GROUP-REQUEST
J83320             PERFORM 700-PRINT-RPT-GRP.
J83320
J83320     MOVE GN4-BLANK-LINE             TO RPT-GROUP-REQUEST.
J83320     PERFORM 700-PRINT-RPT-GRP.
J83320
J83320 300-NEXT.
J83320     INITIALIZE BN1-BNBATCH1-REC.
J83320     PERFORM 800-READCSV-BNBATCH1.
J83320
J83320 300-END.
J83320
J83320******************************************************************
J83320 310-WRITE-BNBATCHERR            SECTION 10.
J83320******************************************************************
J83320 310-START.
J83320
J83320     INITIALIZE BB3-BNBATCHER2-REC.
J83320
J83320     MOVE BN1-FC                     TO BB3-FC.
J83320     MOVE BN1-COMPANY                TO BB3-COMPANY.
J83320     MOVE BN1-ENROLLMENT-DATE        TO BB3-ENROLLMENT-DATE.
J83320     MOVE BN1-EMPLOYEE               TO BB3-EMPLOYEE.
J83320     MOVE BN1-PLAN-TYPE              TO BB3-PLAN-TYPE.
J83320     MOVE BN1-PLAN-CODE              TO BB3-PLAN-CODE.
J83320     MOVE BN1-COVER-OPT              TO BB3-COVER-OPT.
J83320     MOVE BN1-PCT-AMT-FLAG           TO BB3-PCT-AMT-FLAG.
J83320     MOVE BN1-START-DATE             TO BB3-START-DATE.
J83320     MOVE BN1-PRE-AFT-FLAG           TO BB3-PRE-AFT-FLAG.
J83320     MOVE BN1-SMOKER-FLAG            TO BB3-SMOKER-FLAG.
J83320     MOVE BN1-STOP-DATE              TO BB3-STOP-DATE.
J83320     MOVE BN1-PEND-EVIDENCE          TO BB3-PEND-EVIDENCE.
J83320     MOVE BN1-CREATION-DATE          TO BB3-CREATION-DATE.
J83320     MOVE BN1-UPD-DATE               TO BB3-UPD-DATE.
J83320     MOVE BN1-USER-ID                TO BB3-USER-ID.
J83320     MOVE BN1-TIME-STAMP             TO BB3-TIME-STAMP.
J83320     MOVE BN1-CREATE-TRANS           TO BB3-CREATE-TRANS.
J83320     MOVE BN1-REASON                 TO BB3-REASON.
J83320     MOVE BN1-MEMBER-ID              TO BB3-MEMBER-ID.
J83320     MOVE BN1-DED-START-DATE         TO BB3-DED-START-DATE.
J83320     MOVE BN1-DED-STOP-DATE          TO BB3-DED-STOP-DATE.
J83320
J83320**** If there is non-numeric data we do not want to move signed
J83320**** numeric field
J83320     IF  (BN1INFO-ERROR     = "Y")
J83320     AND (BN1INFO-ERROR-NBR = 203)
J83320         CONTINUE
J83320     ELSE
J83320         MOVE BN1-MULT-SALARY        TO BB3-MULT-SALARY
J83320         MOVE BN1-COVER-AMT          TO BB3-COVER-AMT
J83320         MOVE BN1-PAY-RATE           TO BB3-PAY-RATE
J83320         MOVE BN1-EMP-PRE-CONT       TO BB3-EMP-PRE-CONT
J83320         MOVE BN1-EMP-AFT-CONT       TO BB3-EMP-AFT-CONT
J83320         MOVE BN1-YTD-CONT           TO BB3-YTD-CONT
J83320         MOVE BN1-EMP-YTD-CONT       TO BB3-EMP-YTD-CONT
J83320         INITIALIZE BB3-DFT-PRE-CONT
J83320                    BB3-AFT-TAX-TO-SPEND
J83320         IF (BN531WS-113-ERROR)
J83320             MOVE BNFRWS-TOTAL-AVAIL TO BB3-DFT-PRE-CONT
J83320             MOVE BNBEN-EMP-PRE-CONT (I1)
J83320                                     TO BB3-AFT-TAX-TO-SPEND.
J83320
J83320     INITIALIZE WS-FIELD-VALUE.
J83320
J83320     PERFORM 800-WRITECSV-BNBATCHER2.
J83320
J83320 310-END.
J83320******************************************************************
J83320 320-EDIT-INPUT-DATA             SECTION 10.
J83320******************************************************************
J83320 320-START.
J83320
J83320     IF (BN1-COMPANY    = ZEROES)
J83320     OR (BN1-EMPLOYEE   = ZEROES)
J83320     OR (BN1-PLAN-TYPE  = SPACES)
J83320     OR (BN1-PLAN-CODE  = SPACES)
J83320     OR (BN1-START-DATE = ZEROES)
J83320         MOVE 104                        TO CRT-ERROR-NBR
J83320         GO TO 320-END.
J83320
J83320     MOVE BN1-COMPANY            TO DB-COMPANY.
J83320     MOVE BN1-EMPLOYEE           TO DB-EMPLOYEE.
J83320     MOVE BN1-PLAN-TYPE          TO DB-PLAN-TYPE.
J83320     MOVE BN1-PLAN-CODE          TO DB-PLAN-CODE.
J83320     MOVE BN1-START-DATE         TO DB-START-DATE.
J83320     PERFORM 840-FIND-BENSET1.
J83320     IF (BENEFIT-NOTFOUND)
J83320         MOVE 103                        TO CRT-ERROR-NBR
J83320         GO TO 320-END.
J83320
J83320     MOVE BEN-COMP-CONT              TO BN531WS-EMP-COMP-CONT.
J83320     IF (BN1-MULT-SALARY = ZEROES)
J83320         MOVE BEN-MULTIPLE           TO BN1-MULT-SALARY.
J83320     IF (BN1-PCT-AMT-FLAG = SPACES)
J83320         MOVE BEN-PCT-AMT-FLAG       TO BN1-PCT-AMT-FLAG.
J83320     IF (BN1-SMOKER-FLAG = SPACES)
J83320         MOVE BEN-SMOKER             TO BN1-SMOKER-FLAG.
J83320     IF (BN1-EMP-PRE-CONT = ZEROES)
J83320         MOVE BEN-EMP-PRE-CONT       TO BN1-EMP-PRE-CONT.
J83320     IF (BN1-EMP-AFT-CONT = ZEROES)
J83320         MOVE BEN-EMP-AFT-CONT       TO BN1-EMP-AFT-CONT.
J83320     IF (BN1-PLAN-TYPE = "VA")
J83320         IF (BN1-MULT-SALARY = ZEROES)
J83320             MOVE BEN-NBR-HOURS      TO BN1-MULT-SALARY
J83320         END-IF
J83320     ELSE
J83320         IF (BN1-PLAN-TYPE = "SB")
J83320             IF (BN1-COVER-OPT = ZEROES)
J83320                 MOVE BEN-NBR-PURCH  TO BN1-COVER-OPT
J83320             END-IF
J83320         ELSE
J83320             MOVE BN1-COMPANY        TO DB-COMPANY
J83320             MOVE BN1-PLAN-TYPE      TO DB-PLAN-TYPE
J83320             MOVE BN1-PLAN-CODE      TO DB-PLAN-CODE
J83320             PERFORM 840-FIND-PLNSET1
J83320             IF (PLAN-NOTFOUND)
J83320**************** Plan does not exist
J83320                 MOVE "BNBEN"        TO CRT-ERROR-CAT
J83320                 MOVE 103            TO CRT-ERROR-NBR
J83320                 GO TO 320-END
J83320             END-IF
J83320             IF (PLN-CONTRIB-TYPE = "5")
J83320                 IF (BN1-COVER-OPT = ZEROES)
J83320                     MOVE BEN-CYCLES-REMAIN  TO BN1-COVER-OPT
J83320                 END-IF
J83320                 IF (BN1-COVER-AMT = ZEROES)
J83320                     MOVE BEN-BOND-DED-AMT   TO BN1-COVER-AMT
J83320                 END-IF
J83320             ELSE
J83320                 IF (BN1-COVER-OPT = ZEROES)
J83320                     MOVE BEN-COV-OPTION     TO BN1-COVER-OPT
J83320                 END-IF
J83320             END-IF
J83320         END-IF
J83320     END-IF.
J83320     IF (BN1-COVER-AMT = ZEROES)
J83320         MOVE BEN-COVER-AMT          TO BN1-COVER-AMT.
J83320     IF (BN1-PAY-RATE = ZEROES)
J83320         MOVE BEN-PAY-RATE           TO BN1-PAY-RATE.
J83320     IF (BN1-PRE-AFT-FLAG = SPACES)
J83320         MOVE BEN-PRE-AFT-FLAG       TO BN1-PRE-AFT-FLAG.
J83320     IF (BN1-STOP-DATE = ZEROES)
J83320         MOVE BEN-STOP-DATE          TO BN1-STOP-DATE.
J83320     IF (BN1-PEND-EVIDENCE = SPACES)
J83320         MOVE BEN-PEND-EVIDENCE      TO BN1-PEND-EVIDENCE.
J83320     IF  (BN1-YTD-CONT = ZEROES)
J83320     AND (BN1-PLAN-TYPE NOT = "RS" AND "SB" AND "SP")
J83320         MOVE BEN-YTD-CONT           TO BN1-YTD-CONT.
J83320     IF  (BN1-EMP-YTD-CONT = ZEROES)
J83320     AND (BN1-PLAN-TYPE NOT = "RS" AND "SB" AND "SP")
J83320         MOVE BEN-EMP-YTD-CONT       TO BN1-EMP-YTD-CONT.
J83320
J83320     IF (BN1-EMP-YTD-CONT  > BN1-YTD-CONT)
J83320         MOVE 137                        TO CRT-ERROR-NBR
J83320         GO TO 320-END.
J83320
J83320     IF (BN1-FC = "D" OR "S")
J83320         GO TO 320-END.
J83320
J83320     IF   (BEN-STOP-DATE          NOT = BN1-STOP-DATE)
J83320     AND ((BEN-YTD-CONT           NOT = BN1-YTD-CONT)
J83320     OR   (BEN-EMP-YTD-CONT       NOT = BN1-EMP-YTD-CONT))
J83320         MOVE 105                        TO CRT-ERROR-NBR
J83320         GO TO 320-END.
J83320
J83320     IF  (BEN-STOP-DATE          NOT = BN1-STOP-DATE)
J83320     AND (BEN-EMP-YTD-CONT       NOT = BN1-EMP-YTD-CONT)
J83320         MOVE 138                        TO CRT-ERROR-NBR
J83320         GO TO 320-END.
J83320
J83320     IF (BEN-STOP-DATE           NOT = BN1-STOP-DATE)
J83320         MOVE WS-TRUE            TO BN531WS-STOP-BENEFIT-SW
J83320         MOVE WS-FALSE           TO BN531WS-STOP-CONT5-SW
J83320         PERFORM 840-FIND-PLNSET1
J83320         IF  (PLN-CONTRIB-TYPE = "5")
J83320         AND (PLN-FLEX-PLAN NOT = SPACES)
J83320             MOVE PLN-FLEX-PLAN  TO DB-FLEX-PLAN
J83320             PERFORM 840-FIND-FLPSET1
J83320             IF (FLP-SPEND-ONLY = "Y")
J83320                 MOVE WS-TRUE    TO BN531WS-STOP-CONT5-SW
J83320             END-IF
J83320         END-IF
J83320     END-IF.
J83320
J83320     IF (BEN-YTD-CONT            NOT = BN1-YTD-CONT)
J83320     OR (BEN-EMP-YTD-CONT        NOT = BN1-EMP-YTD-CONT)
J83320         IF  (BEN-PLAN-TYPE       = "RS")
J83320             MOVE BN1-PLAN-TYPE      TO DB-PLAN-TYPE
J83320             MOVE BN1-PLAN-CODE      TO DB-PLAN-CODE
J83320             PERFORM 840-FIND-PLNSET1
J83320             MOVE ZEROS          TO BN531WS-TOT-WITHDRAWALS
J83320                                    DB-DATE
J83320                                    DB-CHECK-NBR
J83320             PERFORM 850-FIND-NLT-RTRSET2
J83320             PERFORM
J83320                 UNTIL (RESTRANS-NOTFOUND)
J83320                 OR    (RTR-COMPANY    NOT = DB-COMPANY)
J83320                 OR    (RTR-EMPLOYEE   NOT = DB-EMPLOYEE)
J83320                 OR    (RTR-PLAN-CODE  NOT = DB-PLAN-CODE)
J83320                 OR    (RTR-START-DATE NOT = DB-START-DATE)
J83320
J83320                     ADD RTR-TRANS-AMT TO BN531WS-TOT-WITHDRAWALS
J83320                     PERFORM 860-FIND-NEXT-RTRSET2
J83320             END-PERFORM
J83320             IF  ((BN1-YTD-CONT     < BN531WS-TOT-WITHDRAWALS)
J83320             OR   (BN1-EMP-YTD-CONT < BN531WS-TOT-WITHDRAWALS))
J83320             AND (PLN-PAY-EXP-FLAG    = 2)
J83320                 MOVE 106                TO CRT-ERROR-NBR
J83320                 GO TO 320-END
J83320             END-IF
J83320         ELSE
J83320         IF (BN1-PLAN-TYPE = "SB")
J83320             MOVE BN1-PLAN-TYPE      TO DB-PLAN-TYPE
J83320             MOVE BN1-PLAN-CODE      TO DB-PLAN-CODE
J83320             PERFORM 840-FIND-PLNSET1
J83320             IF ((BN1-YTD-CONT < (BEN-NBR-PURCH * PLN-BOND-COST))
J83320             OR  (BN1-EMP-YTD-CONT 
J83320                               < (BEN-NBR-PURCH * PLN-BOND-COST)))
J83320                 MOVE 106                TO CRT-ERROR-NBR
J83320                 GO TO 320-END
J83320             END-IF
J83320         ELSE
J83320         IF (BN1-PLAN-TYPE = "SP")
J83320             MOVE BN1-COMPANY     TO DB-COMPANY
J83320             MOVE BN1-EMPLOYEE    TO DB-EMPLOYEE
J83320             MOVE "SP"            TO DB-PLAN-TYPE
J83320             MOVE BN1-PLAN-CODE   TO DB-PLAN-CODE
J83320             MOVE BN1-START-DATE  TO DB-START-DATE
J83320             MOVE ZEROS           TO DB-DATE-PURCH
J83320                                     BN531WS-TOT-COST
J83320             PERFORM 850-FIND-NLT-SPHSET1
J83320
J83320             PERFORM 
J83320                 UNTIL (SPHIST-NOTFOUND)
J83320                 OR    (SPH-COMPANY      NOT = DB-COMPANY)
J83320                 OR    (SPH-EMPLOYEE     NOT = DB-EMPLOYEE)
J83320                 OR    (SPH-PLAN-CODE    NOT = DB-PLAN-CODE)
J83320                 OR    (SPH-START-DATE   NOT = DB-START-DATE)
J83320
J83320                 COMPUTE BN531WS-TOT-COST    =  BN531WS-TOT-COST
J83320                                             + (SPH-NBR-SHARES
J83320                                             *  SPH-SHARE-PRICE)
J83320                 PERFORM 860-FIND-NEXT-SPHSET1
J83320             END-PERFORM
J83320             IF ((BN1-YTD-CONT     < BN531WS-TOT-COST)
J83320             OR  (BN1-EMP-YTD-CONT < BN531WS-TOT-COST))
J83320                 MOVE 106                TO CRT-ERROR-NBR
J83320                 GO TO 320-END
J83320             END-IF
J83320         END-IF
J83320     END-IF.
J83320
J83320 320-END.

